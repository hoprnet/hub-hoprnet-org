var la=Object.create;var Ft=Object.defineProperty;var da=Object.getOwnPropertyDescriptor;var ha=Object.getOwnPropertyNames;var pa=Object.getPrototypeOf,ga=Object.prototype.hasOwnProperty;var ya=(e,t)=>()=>(e&&(t=e(e=0)),t);var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Pe=(e,t)=>{for(var r in t)Ft(e,r,{get:t[r],enumerable:!0})},ws=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ha(t))!ga.call(e,s)&&s!==r&&Ft(e,s,{get:()=>t[s],enumerable:!(n=da(t,s))||n.enumerable});return e};var $t=(e,t,r)=>(r=e!=null?la(pa(e)):{},ws(t||!e||!e.__esModule?Ft(r,"default",{value:e,enumerable:!0}):r,e)),ma=e=>ws(Ft({},"__esModule",{value:!0}),e);var vs={};Pe(vs,{default:()=>qa});var dt,qa,Bs=ya(()=>{dt=null;typeof WebSocket<"u"?dt=WebSocket:typeof MozWebSocket<"u"?dt=MozWebSocket:typeof global<"u"?dt=global.WebSocket||global.MozWebSocket:typeof window<"u"?dt=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(dt=self.WebSocket||self.MozWebSocket);qa=dt});var Is=K((sl,Gt)=>{var Wr=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function s(i,a){if(!n[i]){n[i]={};for(var c=0;c<i.length;c++)n[i][i.charAt(c)]=c}return n[i][a]}var o={compressToBase64:function(i){if(i==null)return"";var a=o._compress(i,6,function(c){return t.charAt(c)});switch(a.length%4){default:case 0:return a;case 1:return a+"===";case 2:return a+"==";case 3:return a+"="}},decompressFromBase64:function(i){return i==null?"":i==""?null:o._decompress(i.length,32,function(a){return s(t,i.charAt(a))})},compressToUTF16:function(i){return i==null?"":o._compress(i,15,function(a){return e(a+32)})+" "},decompressFromUTF16:function(i){return i==null?"":i==""?null:o._decompress(i.length,16384,function(a){return i.charCodeAt(a)-32})},compressToUint8Array:function(i){for(var a=o.compress(i),c=new Uint8Array(a.length*2),u=0,f=a.length;u<f;u++){var l=a.charCodeAt(u);c[u*2]=l>>>8,c[u*2+1]=l%256}return c},decompressFromUint8Array:function(i){if(i==null)return o.decompress(i);for(var a=new Array(i.length/2),c=0,u=a.length;c<u;c++)a[c]=i[c*2]*256+i[c*2+1];var f=[];return a.forEach(function(l){f.push(e(l))}),o.decompress(f.join(""))},compressToEncodedURIComponent:function(i){return i==null?"":o._compress(i,6,function(a){return r.charAt(a)})},decompressFromEncodedURIComponent:function(i){return i==null?"":i==""?null:(i=i.replace(/ /g,"+"),o._decompress(i.length,32,function(a){return s(r,i.charAt(a))}))},compress:function(i){return o._compress(i,16,function(a){return e(a)})},_compress:function(i,a,c){if(i==null)return"";var u,f,l={},p={},m="",x="",d="",h=2,b=3,y=2,w=[],g=0,E=0,P;for(P=0;P<i.length;P+=1)if(m=i.charAt(P),Object.prototype.hasOwnProperty.call(l,m)||(l[m]=b++,p[m]=!0),x=d+m,Object.prototype.hasOwnProperty.call(l,x))d=x;else{if(Object.prototype.hasOwnProperty.call(p,d)){if(d.charCodeAt(0)<256){for(u=0;u<y;u++)g=g<<1,E==a-1?(E=0,w.push(c(g)),g=0):E++;for(f=d.charCodeAt(0),u=0;u<8;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1}else{for(f=1,u=0;u<y;u++)g=g<<1|f,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=0;for(f=d.charCodeAt(0),u=0;u<16;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1}h--,h==0&&(h=Math.pow(2,y),y++),delete p[d]}else for(f=l[d],u=0;u<y;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1;h--,h==0&&(h=Math.pow(2,y),y++),l[x]=b++,d=String(m)}if(d!==""){if(Object.prototype.hasOwnProperty.call(p,d)){if(d.charCodeAt(0)<256){for(u=0;u<y;u++)g=g<<1,E==a-1?(E=0,w.push(c(g)),g=0):E++;for(f=d.charCodeAt(0),u=0;u<8;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1}else{for(f=1,u=0;u<y;u++)g=g<<1|f,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=0;for(f=d.charCodeAt(0),u=0;u<16;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1}h--,h==0&&(h=Math.pow(2,y),y++),delete p[d]}else for(f=l[d],u=0;u<y;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1;h--,h==0&&(h=Math.pow(2,y),y++)}for(f=2,u=0;u<y;u++)g=g<<1|f&1,E==a-1?(E=0,w.push(c(g)),g=0):E++,f=f>>1;for(;;)if(g=g<<1,E==a-1){w.push(c(g));break}else E++;return w.join("")},decompress:function(i){return i==null?"":i==""?null:o._decompress(i.length,32768,function(a){return i.charCodeAt(a)})},_decompress:function(i,a,c){var u=[],f,l=4,p=4,m=3,x="",d=[],h,b,y,w,g,E,P,R={val:c(0),position:a,index:1};for(h=0;h<3;h+=1)u[h]=h;for(y=0,g=Math.pow(2,2),E=1;E!=g;)w=R.val&R.position,R.position>>=1,R.position==0&&(R.position=a,R.val=c(R.index++)),y|=(w>0?1:0)*E,E<<=1;switch(f=y){case 0:for(y=0,g=Math.pow(2,8),E=1;E!=g;)w=R.val&R.position,R.position>>=1,R.position==0&&(R.position=a,R.val=c(R.index++)),y|=(w>0?1:0)*E,E<<=1;P=e(y);break;case 1:for(y=0,g=Math.pow(2,16),E=1;E!=g;)w=R.val&R.position,R.position>>=1,R.position==0&&(R.position=a,R.val=c(R.index++)),y|=(w>0?1:0)*E,E<<=1;P=e(y);break;case 2:return""}for(u[3]=P,b=P,d.push(P);;){if(R.index>i)return"";for(y=0,g=Math.pow(2,m),E=1;E!=g;)w=R.val&R.position,R.position>>=1,R.position==0&&(R.position=a,R.val=c(R.index++)),y|=(w>0?1:0)*E,E<<=1;switch(P=y){case 0:for(y=0,g=Math.pow(2,8),E=1;E!=g;)w=R.val&R.position,R.position>>=1,R.position==0&&(R.position=a,R.val=c(R.index++)),y|=(w>0?1:0)*E,E<<=1;u[p++]=e(y),P=p-1,l--;break;case 1:for(y=0,g=Math.pow(2,16),E=1;E!=g;)w=R.val&R.position,R.position>>=1,R.position==0&&(R.position=a,R.val=c(R.index++)),y|=(w>0?1:0)*E,E<<=1;u[p++]=e(y),P=p-1,l--;break;case 2:return d.join("")}if(l==0&&(l=Math.pow(2,m),m++),u[P])x=u[P];else if(P===p)x=b+b.charAt(0);else return null;d.push(x),u[p++]=b+x.charAt(0),l--,b=x,l==0&&(l=Math.pow(2,m),m++)}}};return o}();typeof define=="function"&&define.amd?define(function(){return Wr}):typeof Gt<"u"&&Gt!=null?Gt.exports=Wr:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return Wr})});var gt=K(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.output=fe.exists=fe.hash=fe.bytes=fe.bool=fe.number=fe.isBytes=void 0;function Yt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}fe.number=Yt;function Cs(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}fe.bool=Cs;function Ts(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}fe.isBytes=Ts;function rn(e,...t){if(!Ts(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}fe.bytes=rn;function _s(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Yt(e.outputLen),Yt(e.blockLen)}fe.hash=_s;function Ns(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}fe.exists=Ns;function qs(e,t){rn(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}fe.output=qs;var za={number:Yt,bool:Cs,bytes:rn,hash:_s,exists:Ns,output:qs};fe.default=za});var As=K(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.crypto=void 0;Xt.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});var Me=K(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.randomBytes=N.wrapXOFConstructorWithOpts=N.wrapConstructorWithOpts=N.wrapConstructor=N.checkOpts=N.Hash=N.concatBytes=N.toBytes=N.utf8ToBytes=N.asyncLoop=N.nextTick=N.hexToBytes=N.bytesToHex=N.byteSwap32=N.byteSwapIfBE=N.byteSwap=N.isLE=N.rotl=N.rotr=N.createView=N.u32=N.u8=N.isBytes=void 0;var nn=As(),on=gt();function Ka(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}N.isBytes=Ka;var Za=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);N.u8=Za;var Wa=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));N.u32=Wa;var Ga=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);N.createView=Ga;var Ya=(e,t)=>e<<32-t|e>>>t;N.rotr=Ya;var Xa=(e,t)=>e<<t|e>>>32-t>>>0;N.rotl=Xa;N.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;var Ja=e=>e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255;N.byteSwap=Ja;N.byteSwapIfBE=N.isLE?e=>e:e=>(0,N.byteSwap)(e);function Qa(e){for(let t=0;t<e.length;t++)e[t]=(0,N.byteSwap)(e[t])}N.byteSwap32=Qa;var ec=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function tc(e){(0,on.bytes)(e);let t="";for(let r=0;r<e.length;r++)t+=ec[e[r]];return t}N.bytesToHex=tc;var je={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Os(e){if(e>=je._0&&e<=je._9)return e-je._0;if(e>=je._A&&e<=je._F)return e-(je._A-10);if(e>=je._a&&e<=je._f)return e-(je._a-10)}function rc(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let i=Os(e.charCodeAt(o)),a=Os(e.charCodeAt(o+1));if(i===void 0||a===void 0){let c=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}n[s]=i*16+a}return n}N.hexToBytes=rc;var nc=async()=>{};N.nextTick=nc;async function sc(e,t,r){let n=Date.now();for(let s=0;s<e;s++){r(s);let o=Date.now()-n;o>=0&&o<t||(await(0,N.nextTick)(),n+=o)}}N.asyncLoop=sc;function Ls(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}N.utf8ToBytes=Ls;function Jt(e){return typeof e=="string"&&(e=Ls(e)),(0,on.bytes)(e),e}N.toBytes=Jt;function oc(...e){let t=0;for(let n=0;n<e.length;n++){let s=e[n];(0,on.bytes)(s),t+=s.length}let r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){let o=e[n];r.set(o,s),s+=o.length}return r}N.concatBytes=oc;var sn=class{clone(){return this._cloneInto()}};N.Hash=sn;var ic={}.toString;function ac(e,t){if(t!==void 0&&ic.call(t)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(e,t)}N.checkOpts=ac;function cc(e){let t=n=>e().update(Jt(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}N.wrapConstructor=cc;function uc(e){let t=(n,s)=>e(s).update(Jt(n)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}N.wrapConstructorWithOpts=uc;function fc(e){let t=(n,s)=>e(s).update(Jt(n)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}N.wrapXOFConstructorWithOpts=fc;function lc(e=32){if(nn.crypto&&typeof nn.crypto.getRandomValues=="function")return nn.crypto.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}N.randomBytes=lc});var an=K(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.hmac=tt.HMAC=void 0;var Qt=gt(),Ms=Me(),qt=class extends Ms.Hash{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,(0,Qt.hash)(t);let n=(0,Ms.toBytes)(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let s=this.blockLen,o=new Uint8Array(s);o.set(n.length>s?t.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=t.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(t){return(0,Qt.exists)(this),this.iHash.update(t),this}digestInto(t){(0,Qt.exists)(this),(0,Qt.bytes)(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:s,destroyed:o,blockLen:i,outputLen:a}=this;return t=t,t.finished=s,t.destroyed=o,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};tt.HMAC=qt;var dc=(e,t,r)=>new qt(e,t).update(r).digest();tt.hmac=dc;tt.hmac.create=(e,t)=>new qt(e,t)});var Fs=K(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.hkdf=ze.expand=ze.extract=void 0;var un=gt(),Us=Me(),ks=an();function js(e,t,r){return(0,un.hash)(e),r===void 0&&(r=new Uint8Array(e.outputLen)),(0,ks.hmac)(e,(0,Us.toBytes)(r),(0,Us.toBytes)(t))}ze.extract=js;var cn=new Uint8Array([0]),Ds=new Uint8Array;function Hs(e,t,r,n=32){if((0,un.hash)(e),(0,un.number)(n),n>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(n/e.outputLen);r===void 0&&(r=Ds);let o=new Uint8Array(s*e.outputLen),i=ks.hmac.create(e,t),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let u=0;u<s;u++)cn[0]=u+1,a.update(u===0?Ds:c).update(r).update(cn).digestInto(c),o.set(c,e.outputLen*u),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),cn.fill(0),o.slice(0,n)}ze.expand=Hs;var hc=(e,t,r,n,s)=>Hs(e,js(e,t,r),n,s);ze.hkdf=hc});var $s=K(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.BLAKE=mt.SIGMA=void 0;var yt=gt(),le=Me();mt.SIGMA=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3]);var fn=class extends le.Hash{constructor(t,r,n={},s,o,i){if(super(),this.blockLen=t,this.outputLen=r,this.length=0,this.pos=0,this.finished=!1,this.destroyed=!1,(0,yt.number)(t),(0,yt.number)(r),(0,yt.number)(s),r<0||r>s)throw new Error("outputLen bigger than keyLen");if(n.key!==void 0&&(n.key.length<1||n.key.length>s))throw new Error(`key must be up 1..${s} byte long or undefined`);if(n.salt!==void 0&&n.salt.length!==o)throw new Error(`salt must be ${o} byte long or undefined`);if(n.personalization!==void 0&&n.personalization.length!==i)throw new Error(`personalization must be ${i} byte long or undefined`);this.buffer32=(0,le.u32)(this.buffer=new Uint8Array(t))}update(t){(0,yt.exists)(this);let{blockLen:r,buffer:n,buffer32:s}=this;t=(0,le.toBytes)(t);let o=t.length,i=t.byteOffset,a=t.buffer;for(let c=0;c<o;){this.pos===r&&(le.isLE||(0,le.byteSwap32)(s),this.compress(s,0,!1),le.isLE||(0,le.byteSwap32)(s),this.pos=0);let u=Math.min(r-this.pos,o-c),f=i+c;if(u===r&&!(f%4)&&c+u<o){let l=new Uint32Array(a,f,Math.floor((o-c)/4));le.isLE||(0,le.byteSwap32)(l);for(let p=0;c+r<o;p+=s.length,c+=r)this.length+=r,this.compress(l,p,!1);le.isLE||(0,le.byteSwap32)(l);continue}n.set(t.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(t){(0,yt.exists)(this),(0,yt.output)(t,this);let{pos:r,buffer32:n}=this;this.finished=!0,this.buffer.subarray(r).fill(0),le.isLE||(0,le.byteSwap32)(n),this.compress(n,0,!0),le.isLE||(0,le.byteSwap32)(n);let s=(0,le.u32)(t);this.get().forEach((o,i)=>s[i]=(0,le.byteSwapIfBE)(o))}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){let{buffer:r,length:n,finished:s,destroyed:o,outputLen:i,pos:a}=this;return t||(t=new this.constructor({dkLen:i})),t.set(...this.get()),t.length=n,t.finished=s,t.destroyed=o,t.outputLen=i,t.buffer.set(r),t.pos=a,t}};mt.BLAKE=fn});var lo=K(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.add5L=L.add5H=L.add4H=L.add4L=L.add3H=L.add3L=L.add=L.rotlBL=L.rotlBH=L.rotlSL=L.rotlSH=L.rotr32L=L.rotr32H=L.rotrBL=L.rotrBH=L.rotrSL=L.rotrSH=L.shrSL=L.shrSH=L.toBig=L.split=L.fromBig=void 0;var er=BigInt(2**32-1),ln=BigInt(32);function dn(e,t=!1){return t?{h:Number(e&er),l:Number(e>>ln&er)}:{h:Number(e>>ln&er)|0,l:Number(e&er)|0}}L.fromBig=dn;function Vs(e,t=!1){let r=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let s=0;s<e.length;s++){let{h:o,l:i}=dn(e[s],t);[r[s],n[s]]=[o,i]}return[r,n]}L.split=Vs;var zs=(e,t)=>BigInt(e>>>0)<<ln|BigInt(t>>>0);L.toBig=zs;var Ks=(e,t,r)=>e>>>r;L.shrSH=Ks;var Zs=(e,t,r)=>e<<32-r|t>>>r;L.shrSL=Zs;var Ws=(e,t,r)=>e>>>r|t<<32-r;L.rotrSH=Ws;var Gs=(e,t,r)=>e<<32-r|t>>>r;L.rotrSL=Gs;var Ys=(e,t,r)=>e<<64-r|t>>>r-32;L.rotrBH=Ys;var Xs=(e,t,r)=>e>>>r-32|t<<64-r;L.rotrBL=Xs;var Js=(e,t)=>t;L.rotr32H=Js;var Qs=(e,t)=>e;L.rotr32L=Qs;var eo=(e,t,r)=>e<<r|t>>>32-r;L.rotlSH=eo;var to=(e,t,r)=>t<<r|e>>>32-r;L.rotlSL=to;var ro=(e,t,r)=>t<<r-32|e>>>64-r;L.rotlBH=ro;var no=(e,t,r)=>e<<r-32|t>>>64-r;L.rotlBL=no;function so(e,t,r,n){let s=(t>>>0)+(n>>>0);return{h:e+r+(s/2**32|0)|0,l:s|0}}L.add=so;var oo=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);L.add3L=oo;var io=(e,t,r,n)=>t+r+n+(e/2**32|0)|0;L.add3H=io;var ao=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0);L.add4L=ao;var co=(e,t,r,n,s)=>t+r+n+s+(e/2**32|0)|0;L.add4H=co;var uo=(e,t,r,n,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(s>>>0);L.add5L=uo;var fo=(e,t,r,n,s,o)=>t+r+n+s+o+(e/2**32|0)|0;L.add5H=fo;var pc={fromBig:dn,split:Vs,toBig:zs,shrSH:Ks,shrSL:Zs,rotrSH:Ws,rotrSL:Gs,rotrBH:Ys,rotrBL:Xs,rotr32H:Js,rotr32L:Qs,rotlSH:eo,rotlSL:to,rotlBH:ro,rotlBL:no,add:so,add3L:oo,add3H:io,add4L:ao,add4H:co,add5H:fo,add5L:uo};L.default=pc});var go=K(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.blake2s=G.compress=G.B2S_IV=void 0;var ho=$s(),gc=lo(),Re=Me();G.B2S_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);function Ke(e,t,r,n,s){return e=e+t+s|0,n=(0,Re.rotr)(n^e,16),r=r+n|0,t=(0,Re.rotr)(t^r,12),{a:e,b:t,c:r,d:n}}function Ze(e,t,r,n,s){return e=e+t+s|0,n=(0,Re.rotr)(n^e,8),r=r+n|0,t=(0,Re.rotr)(t^r,7),{a:e,b:t,c:r,d:n}}function po(e,t,r,n,s,o,i,a,c,u,f,l,p,m,x,d,h,b,y,w){let g=0;for(let E=0;E<n;E++)({a:s,b:c,c:p,d:h}=Ke(s,c,p,h,r[t+e[g++]])),{a:s,b:c,c:p,d:h}=Ze(s,c,p,h,r[t+e[g++]]),{a:o,b:u,c:m,d:b}=Ke(o,u,m,b,r[t+e[g++]]),{a:o,b:u,c:m,d:b}=Ze(o,u,m,b,r[t+e[g++]]),{a:i,b:f,c:x,d:y}=Ke(i,f,x,y,r[t+e[g++]]),{a:i,b:f,c:x,d:y}=Ze(i,f,x,y,r[t+e[g++]]),{a,b:l,c:d,d:w}=Ke(a,l,d,w,r[t+e[g++]]),{a,b:l,c:d,d:w}=Ze(a,l,d,w,r[t+e[g++]]),{a:s,b:u,c:x,d:w}=Ke(s,u,x,w,r[t+e[g++]]),{a:s,b:u,c:x,d:w}=Ze(s,u,x,w,r[t+e[g++]]),{a:o,b:f,c:d,d:h}=Ke(o,f,d,h,r[t+e[g++]]),{a:o,b:f,c:d,d:h}=Ze(o,f,d,h,r[t+e[g++]]),{a:i,b:l,c:p,d:b}=Ke(i,l,p,b,r[t+e[g++]]),{a:i,b:l,c:p,d:b}=Ze(i,l,p,b,r[t+e[g++]]),{a,b:c,c:m,d:y}=Ke(a,c,m,y,r[t+e[g++]]),{a,b:c,c:m,d:y}=Ze(a,c,m,y,r[t+e[g++]]);return{v0:s,v1:o,v2:i,v3:a,v4:c,v5:u,v6:f,v7:l,v8:p,v9:m,v10:x,v11:d,v12:h,v13:b,v14:y,v15:w}}G.compress=po;var hn=class extends ho.BLAKE{constructor(t={}){super(64,t.dkLen===void 0?32:t.dkLen,t,32,8,8),this.v0=G.B2S_IV[0]|0,this.v1=G.B2S_IV[1]|0,this.v2=G.B2S_IV[2]|0,this.v3=G.B2S_IV[3]|0,this.v4=G.B2S_IV[4]|0,this.v5=G.B2S_IV[5]|0,this.v6=G.B2S_IV[6]|0,this.v7=G.B2S_IV[7]|0;let r=t.key?t.key.length:0;if(this.v0^=this.outputLen|r<<8|65536|1<<24,t.salt){let n=(0,Re.u32)((0,Re.toBytes)(t.salt));this.v4^=(0,Re.byteSwapIfBE)(n[0]),this.v5^=(0,Re.byteSwapIfBE)(n[1])}if(t.personalization){let n=(0,Re.u32)((0,Re.toBytes)(t.personalization));this.v6^=(0,Re.byteSwapIfBE)(n[0]),this.v7^=(0,Re.byteSwapIfBE)(n[1])}if(t.key){let n=new Uint8Array(this.blockLen);n.set((0,Re.toBytes)(t.key)),this.update(n)}}get(){let{v0:t,v1:r,v2:n,v3:s,v4:o,v5:i,v6:a,v7:c}=this;return[t,r,n,s,o,i,a,c]}set(t,r,n,s,o,i,a,c){this.v0=t|0,this.v1=r|0,this.v2=n|0,this.v3=s|0,this.v4=o|0,this.v5=i|0,this.v6=a|0,this.v7=c|0}compress(t,r,n){let{h:s,l:o}=(0,gc.fromBig)(BigInt(this.length)),{v0:i,v1:a,v2:c,v3:u,v4:f,v5:l,v6:p,v7:m,v8:x,v9:d,v10:h,v11:b,v12:y,v13:w,v14:g,v15:E}=po(ho.SIGMA,r,t,10,this.v0,this.v1,this.v2,this.v3,this.v4,this.v5,this.v6,this.v7,G.B2S_IV[0],G.B2S_IV[1],G.B2S_IV[2],G.B2S_IV[3],o^G.B2S_IV[4],s^G.B2S_IV[5],n?~G.B2S_IV[6]:G.B2S_IV[6],G.B2S_IV[7]);this.v0^=i^x,this.v1^=a^d,this.v2^=c^h,this.v3^=u^b,this.v4^=f^y,this.v5^=l^w,this.v6^=p^g,this.v7^=m^E}destroy(){this.destroyed=!0,this.buffer32.fill(0),this.set(0,0,0,0,0,0,0,0)}};G.blake2s=(0,Re.wrapConstructorWithOpts)(e=>new hn(e))});var rr=K(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.u64Lengths=q.setBigUint64=q.wrapCipher=q.Hash=q.equalBytes=q.ensureBytes=q.checkOpts=q.concatBytes=q.toBytes=q.bytesToUtf8=q.utf8ToBytes=q.asyncLoop=q.nextTick=q.numberToBytesBE=q.bytesToNumberBE=q.hexToNumber=q.hexToBytes=q.bytesToHex=q.isLE=q.createView=q.u32=q.u16=q.u8=void 0;var yc=e=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);q.u8=yc;var mc=e=>new Uint16Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/2));q.u16=mc;var bc=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));q.u32=bc;function tr(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}var xc=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);q.createView=xc;q.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!q.isLE)throw new Error("Non little-endian hardware is not supported");var wc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function mo(e){if(!tr(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=wc[e[r]];return t}q.bytesToHex=mo;var He={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function yo(e){if(e>=He._0&&e<=He._9)return e-He._0;if(e>=He._A&&e<=He._F)return e-(He._A-10);if(e>=He._a&&e<=He._f)return e-(He._a-10)}function bo(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let i=yo(e.charCodeAt(o)),a=yo(e.charCodeAt(o+1));if(i===void 0||a===void 0){let c=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}n[s]=i*16+a}return n}q.hexToBytes=bo;function xo(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}q.hexToNumber=xo;function Ec(e){return xo(mo(e))}q.bytesToNumberBE=Ec;function Rc(e,t){return bo(e.toString(16).padStart(t*2,"0"))}q.numberToBytesBE=Rc;var Sc=async()=>{};q.nextTick=Sc;async function Pc(e,t,r){let n=Date.now();for(let s=0;s<e;s++){r(s);let o=Date.now()-n;o>=0&&o<t||(await(0,q.nextTick)(),n+=o)}}q.asyncLoop=Pc;function wo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}q.utf8ToBytes=wo;function vc(e){return new TextDecoder().decode(e)}q.bytesToUtf8=vc;function Bc(e){if(typeof e=="string")e=wo(e);else if(tr(e))e=e.slice();else throw new Error(`expected Uint8Array, got ${typeof e}`);return e}q.toBytes=Bc;function Ic(...e){let t=0;for(let n=0;n<e.length;n++){let s=e[n];if(!tr(s))throw new Error("Uint8Array expected");t+=s.length}let r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){let o=e[n];r.set(o,s),s+=o.length}return r}q.concatBytes=Ic;var Cc=e=>Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object;function Tc(e,t){if(t!==void 0&&(typeof t!="object"||!Cc(t)))throw new Error("options must be object or undefined");return Object.assign(e,t)}q.checkOpts=Tc;function _c(e,t){if(!tr(e))throw new Error("Uint8Array expected");if(typeof t=="number"&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}q.ensureBytes=_c;function Nc(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}q.equalBytes=Nc;var pn=class{};q.Hash=pn;var qc=(e,t)=>(Object.assign(t,e),t);q.wrapCipher=qc;function gn(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),o=BigInt(4294967295),i=Number(r>>s&o),a=Number(r&o),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}q.setBigUint64=gn;function Ac(e,t){let r=new Uint8Array(16),n=(0,q.createView)(r);return gn(n,0,BigInt(t?t.length:0),!0),gn(n,8,BigInt(e.length),!0),r}q.u64Lengths=Ac});var mn=K(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.output=we.exists=we.hash=we.bytes=we.bool=we.number=void 0;function nr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`wrong positive integer: ${e}`)}we.number=nr;function Eo(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}we.bool=Eo;function Oc(e){return e!=null&&typeof e=="object"&&(e instanceof Uint8Array||e.constructor.name==="Uint8Array")}function yn(e,...t){if(!Oc(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}we.bytes=yn;function Ro(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");nr(e.outputLen),nr(e.blockLen)}we.hash=Ro;function So(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}we.exists=So;function Po(e,t){yn(e);let r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}we.output=Po;var Lc={number:nr,bool:Eo,bytes:yn,hash:Ro,exists:So,output:Po};we.default=Lc});var Bo=K(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.poly1305=bt.wrapConstructorWithKey=void 0;var bn=mn(),sr=rr(),de=(e,t)=>e[t++]&255|(e[t++]&255)<<8,xn=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=(0,sr.toBytes)(t),(0,sr.ensureBytes)(t,32);let r=de(t,0),n=de(t,2),s=de(t,4),o=de(t,6),i=de(t,8),a=de(t,10),c=de(t,12),u=de(t,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|o<<9)&8191,this.r[4]=(o>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let f=0;f<8;f++)this.pad[f]=de(t,16+2*f)}process(t,r,n=!1){let s=n?0:2048,{h:o,r:i}=this,a=i[0],c=i[1],u=i[2],f=i[3],l=i[4],p=i[5],m=i[6],x=i[7],d=i[8],h=i[9],b=de(t,r+0),y=de(t,r+2),w=de(t,r+4),g=de(t,r+6),E=de(t,r+8),P=de(t,r+10),R=de(t,r+12),C=de(t,r+14),U=o[0]+(b&8191),O=o[1]+((b>>>13|y<<3)&8191),_=o[2]+((y>>>10|w<<6)&8191),j=o[3]+((w>>>7|g<<9)&8191),H=o[4]+((g>>>4|E<<12)&8191),z=o[5]+(E>>>1&8191),S=o[6]+((E>>>14|P<<2)&8191),v=o[7]+((P>>>11|R<<5)&8191),T=o[8]+((R>>>8|C<<8)&8191),A=o[9]+(C>>>5|s),B=0,k=B+U*a+O*(5*h)+_*(5*d)+j*(5*x)+H*(5*m);B=k>>>13,k&=8191,k+=z*(5*p)+S*(5*l)+v*(5*f)+T*(5*u)+A*(5*c),B+=k>>>13,k&=8191;let $=B+U*c+O*a+_*(5*h)+j*(5*d)+H*(5*x);B=$>>>13,$&=8191,$+=z*(5*m)+S*(5*p)+v*(5*l)+T*(5*f)+A*(5*u),B+=$>>>13,$&=8191;let F=B+U*u+O*c+_*a+j*(5*h)+H*(5*d);B=F>>>13,F&=8191,F+=z*(5*x)+S*(5*m)+v*(5*p)+T*(5*l)+A*(5*f),B+=F>>>13,F&=8191;let ae=B+U*f+O*u+_*c+j*a+H*(5*h);B=ae>>>13,ae&=8191,ae+=z*(5*d)+S*(5*x)+v*(5*m)+T*(5*p)+A*(5*l),B+=ae>>>13,ae&=8191;let ce=B+U*l+O*f+_*u+j*c+H*a;B=ce>>>13,ce&=8191,ce+=z*(5*h)+S*(5*d)+v*(5*x)+T*(5*m)+A*(5*p),B+=ce>>>13,ce&=8191;let be=B+U*p+O*l+_*f+j*u+H*c;B=be>>>13,be&=8191,be+=z*a+S*(5*h)+v*(5*d)+T*(5*x)+A*(5*m),B+=be>>>13,be&=8191;let Ce=B+U*m+O*p+_*l+j*f+H*u;B=Ce>>>13,Ce&=8191,Ce+=z*c+S*a+v*(5*h)+T*(5*d)+A*(5*x),B+=Ce>>>13,Ce&=8191;let xe=B+U*x+O*m+_*p+j*l+H*f;B=xe>>>13,xe&=8191,xe+=z*u+S*c+v*a+T*(5*h)+A*(5*d),B+=xe>>>13,xe&=8191;let Oe=B+U*d+O*x+_*m+j*p+H*l;B=Oe>>>13,Oe&=8191,Oe+=z*f+S*u+v*c+T*a+A*(5*h),B+=Oe>>>13,Oe&=8191;let Ee=B+U*h+O*d+_*x+j*m+H*p;B=Ee>>>13,Ee&=8191,Ee+=z*l+S*f+v*u+T*c+A*a,B+=Ee>>>13,Ee&=8191,B=(B<<2)+B|0,B=B+k|0,k=B&8191,B=B>>>13,$+=B,o[0]=k,o[1]=$,o[2]=F,o[3]=ae,o[4]=ce,o[5]=be,o[6]=Ce,o[7]=xe,o[8]=Oe,o[9]=Ee}finalize(){let{h:t,pad:r}=this,n=new Uint16Array(10),s=t[1]>>>13;t[1]&=8191;for(let a=2;a<10;a++)t[a]+=s,s=t[a]>>>13,t[a]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,n[0]=t[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=t[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let o=(s^1)-1;for(let a=0;a<10;a++)n[a]&=o;o=~o;for(let a=0;a<10;a++)t[a]=t[a]&o|n[a];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+r[0];t[0]=i&65535;for(let a=1;a<8;a++)i=(t[a]+r[a]|0)+(i>>>16)|0,t[a]=i&65535}update(t){(0,bn.exists)(this);let{buffer:r,blockLen:n}=this;t=(0,sr.toBytes)(t);let s=t.length;for(let o=0;o<s;){let i=Math.min(n-this.pos,s-o);if(i===n){for(;n<=s-o;o+=n)this.process(t,o);continue}r.set(t.subarray(o,o+i),this.pos),this.pos+=i,o+=i,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){(0,bn.exists)(this),(0,bn.output)(t,this),this.finished=!0;let{buffer:r,h:n}=this,{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let o=0;for(let i=0;i<8;i++)t[o++]=n[i]>>>0,t[o++]=n[i]>>>8;return t}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}};function vo(e){let t=(n,s)=>e(s).update((0,sr.toBytes)(n)).digest(),r=e(new Uint8Array(32));return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=n=>e(n),t}bt.wrapConstructorWithKey=vo;bt.poly1305=vo(e=>new xn(e))});var To=K(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.createCipher=xt.rotl=void 0;var Fe=mn(),qe=rr(),Mc=(0,qe.utf8ToBytes)("expand 16-byte k"),Uc=(0,qe.utf8ToBytes)("expand 32-byte k"),Dc=(0,qe.u32)(Mc),kc=(0,qe.u32)(Uc);function jc(e,t){return e<<t|e>>>32-t}xt.rotl=jc;function wn(e){return e.byteOffset%4===0}var or=64,Hc=16,Co=2**32-1,Io=new Uint32Array;function Fc(e,t,r,n,s,o,i,a){let c=s.length,u=new Uint8Array(or),f=(0,qe.u32)(u),l=wn(s)&&wn(o),p=l?(0,qe.u32)(s):Io,m=l?(0,qe.u32)(o):Io;for(let x=0;x<c;i++){if(e(t,r,n,f,i,a),i>=Co)throw new Error("arx: counter overflow");let d=Math.min(or,c-x);if(l&&d===or){let h=x/4;if(x%4!==0)throw new Error("arx: invalid block position");for(let b=0,y;b<Hc;b++)y=h+b,m[y]=p[y]^f[b];x+=or;continue}for(let h=0,b;h<d;h++)b=x+h,o[b]=s[b]^u[h];x+=d}}function $c(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:s,counterRight:o,rounds:i}=(0,qe.checkOpts)({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return(0,Fe.number)(s),(0,Fe.number)(i),(0,Fe.bool)(o),(0,Fe.bool)(r),(a,c,u,f,l=0)=>{(0,Fe.bytes)(a),(0,Fe.bytes)(c),(0,Fe.bytes)(u);let p=u.length;if(f||(f=new Uint8Array(p)),(0,Fe.bytes)(f),(0,Fe.number)(l),l<0||l>=Co)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);let m=[],x=a.length,d,h;if(x===32)d=a.slice(),m.push(d),h=kc;else if(x===16&&r)d=new Uint8Array(32),d.set(a),d.set(a,16),h=Dc,m.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${x}`);wn(c)||(c=c.slice(),m.push(c));let b=(0,qe.u32)(d);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(h,b,(0,qe.u32)(c.subarray(0,16)),b),c=c.subarray(16)}let y=16-s;if(y!==c.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){let g=new Uint8Array(12);g.set(c,o?0:12-c.length),c=g,m.push(c)}let w=(0,qe.u32)(c);for(Fc(e,h,b,w,u,f,l,i);m.length>0;)m.pop().fill(0);return f}}xt.createCipher=$c});var Ao=K(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.xchacha20poly1305=X.chacha20poly1305=X._poly1305_aead=X.chacha12=X.chacha8=X.xchacha20=X.chacha20=X.chacha20orig=X.hchacha=void 0;var Ue=rr(),Vc=Bo(),I=To();function At(e,t,r,n,s,o=20){let i=e[0],a=e[1],c=e[2],u=e[3],f=t[0],l=t[1],p=t[2],m=t[3],x=t[4],d=t[5],h=t[6],b=t[7],y=s,w=r[0],g=r[1],E=r[2],P=i,R=a,C=c,U=u,O=f,_=l,j=p,H=m,z=x,S=d,v=h,T=b,A=y,B=w,k=g,$=E;for(let ae=0;ae<o;ae+=2)P=P+O|0,A=(0,I.rotl)(A^P,16),z=z+A|0,O=(0,I.rotl)(O^z,12),P=P+O|0,A=(0,I.rotl)(A^P,8),z=z+A|0,O=(0,I.rotl)(O^z,7),R=R+_|0,B=(0,I.rotl)(B^R,16),S=S+B|0,_=(0,I.rotl)(_^S,12),R=R+_|0,B=(0,I.rotl)(B^R,8),S=S+B|0,_=(0,I.rotl)(_^S,7),C=C+j|0,k=(0,I.rotl)(k^C,16),v=v+k|0,j=(0,I.rotl)(j^v,12),C=C+j|0,k=(0,I.rotl)(k^C,8),v=v+k|0,j=(0,I.rotl)(j^v,7),U=U+H|0,$=(0,I.rotl)($^U,16),T=T+$|0,H=(0,I.rotl)(H^T,12),U=U+H|0,$=(0,I.rotl)($^U,8),T=T+$|0,H=(0,I.rotl)(H^T,7),P=P+_|0,$=(0,I.rotl)($^P,16),v=v+$|0,_=(0,I.rotl)(_^v,12),P=P+_|0,$=(0,I.rotl)($^P,8),v=v+$|0,_=(0,I.rotl)(_^v,7),R=R+j|0,A=(0,I.rotl)(A^R,16),T=T+A|0,j=(0,I.rotl)(j^T,12),R=R+j|0,A=(0,I.rotl)(A^R,8),T=T+A|0,j=(0,I.rotl)(j^T,7),C=C+H|0,B=(0,I.rotl)(B^C,16),z=z+B|0,H=(0,I.rotl)(H^z,12),C=C+H|0,B=(0,I.rotl)(B^C,8),z=z+B|0,H=(0,I.rotl)(H^z,7),U=U+O|0,k=(0,I.rotl)(k^U,16),S=S+k|0,O=(0,I.rotl)(O^S,12),U=U+O|0,k=(0,I.rotl)(k^U,8),S=S+k|0,O=(0,I.rotl)(O^S,7);let F=0;n[F++]=i+P|0,n[F++]=a+R|0,n[F++]=c+C|0,n[F++]=u+U|0,n[F++]=f+O|0,n[F++]=l+_|0,n[F++]=p+j|0,n[F++]=m+H|0,n[F++]=x+z|0,n[F++]=d+S|0,n[F++]=h+v|0,n[F++]=b+T|0,n[F++]=y+A|0,n[F++]=w+B|0,n[F++]=g+k|0,n[F++]=E+$|0}function qo(e,t,r,n){let s=e[0],o=e[1],i=e[2],a=e[3],c=t[0],u=t[1],f=t[2],l=t[3],p=t[4],m=t[5],x=t[6],d=t[7],h=r[0],b=r[1],y=r[2],w=r[3];for(let E=0;E<20;E+=2)s=s+c|0,h=(0,I.rotl)(h^s,16),p=p+h|0,c=(0,I.rotl)(c^p,12),s=s+c|0,h=(0,I.rotl)(h^s,8),p=p+h|0,c=(0,I.rotl)(c^p,7),o=o+u|0,b=(0,I.rotl)(b^o,16),m=m+b|0,u=(0,I.rotl)(u^m,12),o=o+u|0,b=(0,I.rotl)(b^o,8),m=m+b|0,u=(0,I.rotl)(u^m,7),i=i+f|0,y=(0,I.rotl)(y^i,16),x=x+y|0,f=(0,I.rotl)(f^x,12),i=i+f|0,y=(0,I.rotl)(y^i,8),x=x+y|0,f=(0,I.rotl)(f^x,7),a=a+l|0,w=(0,I.rotl)(w^a,16),d=d+w|0,l=(0,I.rotl)(l^d,12),a=a+l|0,w=(0,I.rotl)(w^a,8),d=d+w|0,l=(0,I.rotl)(l^d,7),s=s+u|0,w=(0,I.rotl)(w^s,16),x=x+w|0,u=(0,I.rotl)(u^x,12),s=s+u|0,w=(0,I.rotl)(w^s,8),x=x+w|0,u=(0,I.rotl)(u^x,7),o=o+f|0,h=(0,I.rotl)(h^o,16),d=d+h|0,f=(0,I.rotl)(f^d,12),o=o+f|0,h=(0,I.rotl)(h^o,8),d=d+h|0,f=(0,I.rotl)(f^d,7),i=i+l|0,b=(0,I.rotl)(b^i,16),p=p+b|0,l=(0,I.rotl)(l^p,12),i=i+l|0,b=(0,I.rotl)(b^i,8),p=p+b|0,l=(0,I.rotl)(l^p,7),a=a+c|0,y=(0,I.rotl)(y^a,16),m=m+y|0,c=(0,I.rotl)(c^m,12),a=a+c|0,y=(0,I.rotl)(y^a,8),m=m+y|0,c=(0,I.rotl)(c^m,7);let g=0;n[g++]=s,n[g++]=o,n[g++]=i,n[g++]=a,n[g++]=h,n[g++]=b,n[g++]=y,n[g++]=w}X.hchacha=qo;X.chacha20orig=(0,I.createCipher)(At,{counterRight:!1,counterLength:8,allowShortKeys:!0});X.chacha20=(0,I.createCipher)(At,{counterRight:!1,counterLength:4,allowShortKeys:!1});X.xchacha20=(0,I.createCipher)(At,{counterRight:!1,counterLength:8,extendNonceFn:qo,allowShortKeys:!1});X.chacha8=(0,I.createCipher)(At,{counterRight:!1,counterLength:4,rounds:8});X.chacha12=(0,I.createCipher)(At,{counterRight:!1,counterLength:4,rounds:12});var zc=new Uint8Array(16),_o=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(zc.subarray(r))},Kc=new Uint8Array(32);function No(e,t,r,n,s){let o=e(t,r,Kc),i=Vc.poly1305.create(o);s&&_o(i,s),_o(i,n);let a=new Uint8Array(16),c=(0,Ue.createView)(a);(0,Ue.setBigUint64)(c,0,BigInt(s?s.length:0),!0),(0,Ue.setBigUint64)(c,8,BigInt(n.length),!0),i.update(a);let u=i.digest();return o.fill(0),u}var Zc=e=>(t,r,n)=>((0,Ue.ensureBytes)(t,32),(0,Ue.ensureBytes)(r),{encrypt:(o,i)=>{let a=o.length,c=a+16;i?(0,Ue.ensureBytes)(i,c):i=new Uint8Array(c),e(t,r,o,i,1);let u=No(e,t,r,i.subarray(0,-16),n);return i.set(u,a),i},decrypt:(o,i)=>{let a=o.length,c=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");i?(0,Ue.ensureBytes)(i,c):i=new Uint8Array(c);let u=o.subarray(0,-16),f=o.subarray(-16),l=No(e,t,r,u,n);if(!(0,Ue.equalBytes)(f,l))throw new Error("invalid tag");return e(t,r,u,i,1),i}});X._poly1305_aead=Zc;X.chacha20poly1305=(0,Ue.wrapCipher)({blockSize:64,nonceLength:12,tagLength:16},(0,X._poly1305_aead)(X.chacha20));X.xchacha20poly1305=(0,Ue.wrapCipher)({blockSize:64,nonceLength:24,tagLength:16},(0,X._poly1305_aead)(X.xchacha20))});var Oo=K(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.HashMD=We.Maj=We.Chi=void 0;var En=gt(),Ot=Me();function Wc(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),o=BigInt(4294967295),i=Number(r>>s&o),a=Number(r&o),c=n?4:0,u=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+u,a,n)}var Gc=(e,t,r)=>e&t^~e&r;We.Chi=Gc;var Yc=(e,t,r)=>e&t^e&r^t&r;We.Maj=Yc;var Rn=class extends Ot.Hash{constructor(t,r,n,s){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,Ot.createView)(this.buffer)}update(t){(0,En.exists)(this);let{view:r,buffer:n,blockLen:s}=this;t=(0,Ot.toBytes)(t);let o=t.length;for(let i=0;i<o;){let a=Math.min(s-this.pos,o-i);if(a===s){let c=(0,Ot.createView)(t);for(;s<=o-i;i+=s)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){(0,En.exists)(this),(0,En.output)(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:o}=this,{pos:i}=this;r[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>s-i&&(this.process(n,0),i=0);for(let l=i;l<s;l++)r[l]=0;Wc(n,s-8,BigInt(this.length*8),o),this.process(n,0);let a=(0,Ot.createView)(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,f[l],o)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:o,destroyed:i,pos:a}=this;return t.length=s,t.pos=a,t.finished=o,t.destroyed=i,s%r&&t.buffer.set(n),t}};We.HashMD=Rn});var Lo=K(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.sha224=wt.sha256=void 0;var Sn=Oo(),Te=Me(),Xc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ge=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ye=new Uint32Array(64),ir=class extends Sn.HashMD{constructor(){super(64,32,8,!1),this.A=Ge[0]|0,this.B=Ge[1]|0,this.C=Ge[2]|0,this.D=Ge[3]|0,this.E=Ge[4]|0,this.F=Ge[5]|0,this.G=Ge[6]|0,this.H=Ge[7]|0}get(){let{A:t,B:r,C:n,D:s,E:o,F:i,G:a,H:c}=this;return[t,r,n,s,o,i,a,c]}set(t,r,n,s,o,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let l=0;l<16;l++,r+=4)Ye[l]=t.getUint32(r,!1);for(let l=16;l<64;l++){let p=Ye[l-15],m=Ye[l-2],x=(0,Te.rotr)(p,7)^(0,Te.rotr)(p,18)^p>>>3,d=(0,Te.rotr)(m,17)^(0,Te.rotr)(m,19)^m>>>10;Ye[l]=d+Ye[l-7]+x+Ye[l-16]|0}let{A:n,B:s,C:o,D:i,E:a,F:c,G:u,H:f}=this;for(let l=0;l<64;l++){let p=(0,Te.rotr)(a,6)^(0,Te.rotr)(a,11)^(0,Te.rotr)(a,25),m=f+p+(0,Sn.Chi)(a,c,u)+Xc[l]+Ye[l]|0,d=((0,Te.rotr)(n,2)^(0,Te.rotr)(n,13)^(0,Te.rotr)(n,22))+(0,Sn.Maj)(n,s,o)|0;f=u,u=c,c=a,a=i+m|0,i=o,o=s,s=n,n=m+d|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(n,s,o,i,a,c,u,f)}roundClean(){Ye.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Pn=class extends ir{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};wt.sha256=(0,Te.wrapConstructor)(()=>new ir);wt.sha224=(0,Te.wrapConstructor)(()=>new Pn)});var rt=K(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.validateObject=M.createHmacDrbg=M.bitMask=M.bitSet=M.bitGet=M.bitLen=M.utf8ToBytes=M.equalBytes=M.concatBytes=M.ensureBytes=M.numberToVarBytesBE=M.numberToBytesLE=M.numberToBytesBE=M.bytesToNumberLE=M.bytesToNumberBE=M.hexToBytes=M.hexToNumber=M.numberToHexUnpadded=M.bytesToHex=M.abytes=M.isBytes=void 0;var Do=BigInt(0),ar=BigInt(1),Jc=BigInt(2);function cr(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}M.isBytes=cr;function ur(e){if(!cr(e))throw new Error("Uint8Array expected")}M.abytes=ur;var Qc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Bn(e){ur(e);let t="";for(let r=0;r<e.length;r++)t+=Qc[e[r]];return t}M.bytesToHex=Bn;function ko(e){let t=e.toString(16);return t.length&1?`0${t}`:t}M.numberToHexUnpadded=ko;function In(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}M.hexToNumber=In;var $e={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Mo(e){if(e>=$e._0&&e<=$e._9)return e-$e._0;if(e>=$e._A&&e<=$e._F)return e-($e._A-10);if(e>=$e._a&&e<=$e._f)return e-($e._a-10)}function fr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);let t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let i=Mo(e.charCodeAt(o)),a=Mo(e.charCodeAt(o+1));if(i===void 0||a===void 0){let c=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+o)}n[s]=i*16+a}return n}M.hexToBytes=fr;function eu(e){return In(Bn(e))}M.bytesToNumberBE=eu;function tu(e){return ur(e),In(Bn(Uint8Array.from(e).reverse()))}M.bytesToNumberLE=tu;function jo(e,t){return fr(e.toString(16).padStart(t*2,"0"))}M.numberToBytesBE=jo;function ru(e,t){return jo(e,t).reverse()}M.numberToBytesLE=ru;function nu(e){return fr(ko(e))}M.numberToVarBytesBE=nu;function su(e,t,r){let n;if(typeof t=="string")try{n=fr(t)}catch(o){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${o}`)}else if(cr(t))n=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);let s=n.length;if(typeof r=="number"&&s!==r)throw new Error(`${e} expected ${r} bytes, got ${s}`);return n}M.ensureBytes=su;function Ho(...e){let t=0;for(let n=0;n<e.length;n++){let s=e[n];ur(s),t+=s.length}let r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){let o=e[n];r.set(o,s),s+=o.length}return r}M.concatBytes=Ho;function ou(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}M.equalBytes=ou;function iu(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}M.utf8ToBytes=iu;function au(e){let t;for(t=0;e>Do;e>>=ar,t+=1);return t}M.bitLen=au;function cu(e,t){return e>>BigInt(t)&ar}M.bitGet=cu;function uu(e,t,r){return e|(r?ar:Do)<<BigInt(t)}M.bitSet=uu;var fu=e=>(Jc<<BigInt(e-1))-ar;M.bitMask=fu;var vn=e=>new Uint8Array(e),Uo=e=>Uint8Array.from(e);function lu(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=vn(e),s=vn(e),o=0,i=()=>{n.fill(1),s.fill(0),o=0},a=(...l)=>r(s,n,...l),c=(l=vn())=>{s=a(Uo([0]),l),n=a(),l.length!==0&&(s=a(Uo([1]),l),n=a())},u=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let l=0,p=[];for(;l<t;){n=a();let m=n.slice();p.push(m),l+=n.length}return Ho(...p)};return(l,p)=>{i(),c(l);let m;for(;!(m=p(u()));)c();return i(),m}}M.createHmacDrbg=lu;var du={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||cr(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function hu(e,t,r={}){let n=(s,o,i)=>{let a=du[o];if(typeof a!="function")throw new Error(`Invalid validator "${o}", expected function`);let c=e[s];if(!(i&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${o}`)};for(let[s,o]of Object.entries(t))n(s,o,!1);for(let[s,o]of Object.entries(r))n(s,o,!0);return e}M.validateObject=hu});var Lt=K(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.mapHashToField=D.getMinHashLength=D.getFieldBytesLength=D.hashToPrivateScalar=D.FpSqrtEven=D.FpSqrtOdd=D.Field=D.nLength=D.FpIsSquare=D.FpDiv=D.FpInvertBatch=D.FpPow=D.validateField=D.isNegativeLE=D.FpSqrt=D.tonelliShanks=D.invert=D.pow2=D.pow=D.mod=void 0;var Be=rt(),se=BigInt(0),Z=BigInt(1),Xe=BigInt(2),pu=BigInt(3),Cn=BigInt(4),Fo=BigInt(5),$o=BigInt(8),gu=BigInt(9),yu=BigInt(16);function ve(e,t){let r=e%t;return r>=se?r:t+r}D.mod=ve;function Vo(e,t,r){if(r<=se||t<se)throw new Error("Expected power/modulo > 0");if(r===Z)return se;let n=Z;for(;t>se;)t&Z&&(n=n*e%r),e=e*e%r,t>>=Z;return n}D.pow=Vo;function mu(e,t,r){let n=e;for(;t-- >se;)n*=n,n%=r;return n}D.pow2=mu;function lr(e,t){if(e===se||t<=se)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=ve(e,t),n=t,s=se,o=Z,i=Z,a=se;for(;r!==se;){let u=n/r,f=n%r,l=s-i*u,p=o-a*u;n=r,r=f,s=i,o=a,i=l,a=p}if(n!==Z)throw new Error("invert: does not exist");return ve(s,t)}D.invert=lr;function zo(e){let t=(e-Z)/Xe,r,n,s;for(r=e-Z,n=0;r%Xe===se;r/=Xe,n++);for(s=Xe;s<e&&Vo(s,t,e)!==e-Z;s++);if(n===1){let i=(e+Z)/Cn;return function(c,u){let f=c.pow(u,i);if(!c.eql(c.sqr(f),u))throw new Error("Cannot find square root");return f}}let o=(r+Z)/Xe;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,f=a.pow(a.mul(a.ONE,s),r),l=a.pow(c,o),p=a.pow(c,r);for(;!a.eql(p,a.ONE);){if(a.eql(p,a.ZERO))return a.ZERO;let m=1;for(let d=a.sqr(p);m<u&&!a.eql(d,a.ONE);m++)d=a.sqr(d);let x=a.pow(f,Z<<BigInt(u-m-1));f=a.sqr(x),l=a.mul(l,x),p=a.mul(p,f),u=m}return l}}D.tonelliShanks=zo;function Ko(e){if(e%Cn===pu){let t=(e+Z)/Cn;return function(n,s){let o=n.pow(s,t);if(!n.eql(n.sqr(o),s))throw new Error("Cannot find square root");return o}}if(e%$o===Fo){let t=(e-Fo)/$o;return function(n,s){let o=n.mul(s,Xe),i=n.pow(o,t),a=n.mul(s,i),c=n.mul(n.mul(a,Xe),i),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),s))throw new Error("Cannot find square root");return u}}return e%yu,zo(e)}D.FpSqrt=Ko;var bu=(e,t)=>(ve(e,t)&Z)===Z;D.isNegativeLE=bu;var xu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function wu(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=xu.reduce((n,s)=>(n[s]="function",n),t);return(0,Be.validateObject)(e,r)}D.validateField=wu;function Zo(e,t,r){if(r<se)throw new Error("Expected power > 0");if(r===se)return e.ONE;if(r===Z)return t;let n=e.ONE,s=t;for(;r>se;)r&Z&&(n=e.mul(n,s)),s=e.sqr(s),r>>=Z;return n}D.FpPow=Zo;function Wo(e,t){let r=new Array(t.length),n=t.reduce((o,i,a)=>e.is0(i)?o:(r[a]=o,e.mul(o,i)),e.ONE),s=e.inv(n);return t.reduceRight((o,i,a)=>e.is0(i)?o:(r[a]=e.mul(o,r[a]),e.mul(o,i)),s),r}D.FpInvertBatch=Wo;function Eu(e,t,r){return e.mul(t,typeof r=="bigint"?lr(r,e.ORDER):e.inv(r))}D.FpDiv=Eu;function Ru(e){let t=(e.ORDER-Z)/Xe;return r=>{let n=e.pow(r,t);return e.eql(n,e.ZERO)||e.eql(n,e.ONE)}}D.FpIsSquare=Ru;function Tn(e,t){let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}D.nLength=Tn;function Su(e,t,r=!1,n={}){if(e<=se)throw new Error(`Expected Field ORDER > 0, got ${e}`);let{nBitLength:s,nByteLength:o}=Tn(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");let i=Ko(e),a=Object.freeze({ORDER:e,BITS:s,BYTES:o,MASK:(0,Be.bitMask)(s),ZERO:se,ONE:Z,create:c=>ve(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return se<=c&&c<e},is0:c=>c===se,isOdd:c=>(c&Z)===Z,neg:c=>ve(-c,e),eql:(c,u)=>c===u,sqr:c=>ve(c*c,e),add:(c,u)=>ve(c+u,e),sub:(c,u)=>ve(c-u,e),mul:(c,u)=>ve(c*u,e),pow:(c,u)=>Zo(a,c,u),div:(c,u)=>ve(c*lr(u,e),e),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>lr(c,e),sqrt:n.sqrt||(c=>i(a,c)),invertBatch:c=>Wo(a,c),cmov:(c,u,f)=>f?u:c,toBytes:c=>r?(0,Be.numberToBytesLE)(c,o):(0,Be.numberToBytesBE)(c,o),fromBytes:c=>{if(c.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${c.length}`);return r?(0,Be.bytesToNumberLE)(c):(0,Be.bytesToNumberBE)(c)}});return Object.freeze(a)}D.Field=Su;function Pu(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");let r=e.sqrt(t);return e.isOdd(r)?r:e.neg(r)}D.FpSqrtOdd=Pu;function vu(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");let r=e.sqrt(t);return e.isOdd(r)?e.neg(r):r}D.FpSqrtEven=vu;function Bu(e,t,r=!1){e=(0,Be.ensureBytes)("privateHash",e);let n=e.length,s=Tn(t).nByteLength+8;if(s<24||n<s||n>1024)throw new Error(`hashToPrivateScalar: expected ${s}-1024 bytes of input, got ${n}`);let o=r?(0,Be.bytesToNumberLE)(e):(0,Be.bytesToNumberBE)(e);return ve(o,t-Z)+Z}D.hashToPrivateScalar=Bu;function _n(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}D.getFieldBytesLength=_n;function Go(e){let t=_n(e);return t+Math.ceil(t/2)}D.getMinHashLength=Go;function Iu(e,t,r=!1){let n=e.length,s=_n(t),o=Go(t);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);let i=r?(0,Be.bytesToNumberBE)(e):(0,Be.bytesToNumberLE)(e),a=ve(i,t-Z)+Z;return r?(0,Be.numberToBytesLE)(a,s):(0,Be.numberToBytesBE)(a,s)}D.mapHashToField=Iu});var Xo=K(Et=>{"use strict";Object.defineProperty(Et,"__esModule",{value:!0});Et.validateBasic=Et.wNAF=void 0;var Yo=Lt(),Cu=rt(),Tu=BigInt(0),Nn=BigInt(1);function _u(e,t){let r=(s,o)=>{let i=o.negate();return s?i:o},n=s=>{let o=Math.ceil(t/s)+1,i=2**(s-1);return{windows:o,windowSize:i}};return{constTimeNegate:r,unsafeLadder(s,o){let i=e.ZERO,a=s;for(;o>Tu;)o&Nn&&(i=i.add(a)),a=a.double(),o>>=Nn;return i},precomputeWindow(s,o){let{windows:i,windowSize:a}=n(o),c=[],u=s,f=u;for(let l=0;l<i;l++){f=u,c.push(f);for(let p=1;p<a;p++)f=f.add(u),c.push(f);u=f.double()}return c},wNAF(s,o,i){let{windows:a,windowSize:c}=n(s),u=e.ZERO,f=e.BASE,l=BigInt(2**s-1),p=2**s,m=BigInt(s);for(let x=0;x<a;x++){let d=x*c,h=Number(i&l);i>>=m,h>c&&(h-=p,i+=Nn);let b=d,y=d+Math.abs(h)-1,w=x%2!==0,g=h<0;h===0?f=f.add(r(w,o[b])):u=u.add(r(g,o[y]))}return{p:u,f}},wNAFCached(s,o,i,a){let c=s._WINDOW_SIZE||1,u=o.get(s);return u||(u=this.precomputeWindow(s,c),c!==1&&o.set(s,a(u))),this.wNAF(c,u,i)}}}Et.wNAF=_u;function Nu(e){return(0,Yo.validateField)(e.Fp),(0,Cu.validateObject)(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,Yo.nLength)(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}Et.validateBasic=Nu});var An=K(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.mapToCurveSimpleSWU=oe.SWUFpSqrtRatio=oe.weierstrass=oe.weierstrassPoints=oe.DER=void 0;var Rt=Lt(),J=rt(),De=rt(),qn=Xo();function qu(e){let t=(0,qn.validateBasic)(e);J.validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});let{endo:r,Fp:n,a:s}=t;if(r){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}var{bytesToNumberBE:Au,hexToBytes:Ou}=J;oe.DER={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){let{Err:t}=oe.DER;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");let r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(n[0]&128)throw new t("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Au(n),l:e.subarray(r+2)}},toSig(e){let{Err:t}=oe.DER,r=typeof e=="string"?Ou(e):e;J.abytes(r);let n=r.length;if(n<2||r[0]!=48)throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");let{d:s,l:o}=oe.DER._parseInt(r.subarray(2)),{d:i,l:a}=oe.DER._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:i}},hexFromSig(e){let t=u=>Number.parseInt(u[0],16)&8?"00"+u:u,r=u=>{let f=u.toString(16);return f.length&1?`0${f}`:f},n=t(r(e.s)),s=t(r(e.r)),o=n.length/2,i=s.length/2,a=r(o),c=r(i);return`30${r(i+o+4)}02${c}${s}02${a}${n}`}};var Ae=BigInt(0),re=BigInt(1),Je=BigInt(2),dr=BigInt(3),Jo=BigInt(4);function Qo(e){let t=qu(e),{Fp:r}=t,n=t.toBytes||((x,d,h)=>{let b=d.toAffine();return J.concatBytes(Uint8Array.from([4]),r.toBytes(b.x),r.toBytes(b.y))}),s=t.fromBytes||(x=>{let d=x.subarray(1),h=r.fromBytes(d.subarray(0,r.BYTES)),b=r.fromBytes(d.subarray(r.BYTES,2*r.BYTES));return{x:h,y:b}});function o(x){let{a:d,b:h}=t,b=r.sqr(x),y=r.mul(b,x);return r.add(r.add(y,r.mul(x,d)),h)}if(!r.eql(r.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function i(x){return typeof x=="bigint"&&Ae<x&&x<t.n}function a(x){if(!i(x))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(x){let{allowedPrivateKeyLengths:d,nByteLength:h,wrapPrivateKey:b,n:y}=t;if(d&&typeof x!="bigint"){if(J.isBytes(x)&&(x=J.bytesToHex(x)),typeof x!="string"||!d.includes(x.length))throw new Error("Invalid key");x=x.padStart(h*2,"0")}let w;try{w=typeof x=="bigint"?x:J.bytesToNumberBE((0,De.ensureBytes)("private key",x,h))}catch{throw new Error(`private key must be ${h} bytes, hex or bigint, not ${typeof x}`)}return b&&(w=Rt.mod(w,y)),a(w),w}let u=new Map;function f(x){if(!(x instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,h,b){if(this.px=d,this.py=h,this.pz=b,d==null||!r.isValid(d))throw new Error("x required");if(h==null||!r.isValid(h))throw new Error("y required");if(b==null||!r.isValid(b))throw new Error("z required")}static fromAffine(d){let{x:h,y:b}=d||{};if(!d||!r.isValid(h)||!r.isValid(b))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");let y=w=>r.eql(w,r.ZERO);return y(h)&&y(b)?l.ZERO:new l(h,b,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){let h=r.invertBatch(d.map(b=>b.pz));return d.map((b,y)=>b.toAffine(h[y])).map(l.fromAffine)}static fromHex(d){let h=l.fromAffine(s((0,De.ensureBytes)("pointHex",d)));return h.assertValidity(),h}static fromPrivateKey(d){return l.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}let{x:d,y:h}=this.toAffine();if(!r.isValid(d)||!r.isValid(h))throw new Error("bad point: x or y not FE");let b=r.sqr(h),y=o(d);if(!r.eql(b,y))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){let{y:d}=this.toAffine();if(r.isOdd)return!r.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);let{px:h,py:b,pz:y}=this,{px:w,py:g,pz:E}=d,P=r.eql(r.mul(h,E),r.mul(w,y)),R=r.eql(r.mul(b,E),r.mul(g,y));return P&&R}negate(){return new l(this.px,r.neg(this.py),this.pz)}double(){let{a:d,b:h}=t,b=r.mul(h,dr),{px:y,py:w,pz:g}=this,E=r.ZERO,P=r.ZERO,R=r.ZERO,C=r.mul(y,y),U=r.mul(w,w),O=r.mul(g,g),_=r.mul(y,w);return _=r.add(_,_),R=r.mul(y,g),R=r.add(R,R),E=r.mul(d,R),P=r.mul(b,O),P=r.add(E,P),E=r.sub(U,P),P=r.add(U,P),P=r.mul(E,P),E=r.mul(_,E),R=r.mul(b,R),O=r.mul(d,O),_=r.sub(C,O),_=r.mul(d,_),_=r.add(_,R),R=r.add(C,C),C=r.add(R,C),C=r.add(C,O),C=r.mul(C,_),P=r.add(P,C),O=r.mul(w,g),O=r.add(O,O),C=r.mul(O,_),E=r.sub(E,C),R=r.mul(O,U),R=r.add(R,R),R=r.add(R,R),new l(E,P,R)}add(d){f(d);let{px:h,py:b,pz:y}=this,{px:w,py:g,pz:E}=d,P=r.ZERO,R=r.ZERO,C=r.ZERO,U=t.a,O=r.mul(t.b,dr),_=r.mul(h,w),j=r.mul(b,g),H=r.mul(y,E),z=r.add(h,b),S=r.add(w,g);z=r.mul(z,S),S=r.add(_,j),z=r.sub(z,S),S=r.add(h,y);let v=r.add(w,E);return S=r.mul(S,v),v=r.add(_,H),S=r.sub(S,v),v=r.add(b,y),P=r.add(g,E),v=r.mul(v,P),P=r.add(j,H),v=r.sub(v,P),C=r.mul(U,S),P=r.mul(O,H),C=r.add(P,C),P=r.sub(j,C),C=r.add(j,C),R=r.mul(P,C),j=r.add(_,_),j=r.add(j,_),H=r.mul(U,H),S=r.mul(O,S),j=r.add(j,H),H=r.sub(_,H),H=r.mul(U,H),S=r.add(S,H),_=r.mul(j,S),R=r.add(R,_),_=r.mul(v,S),P=r.mul(z,P),P=r.sub(P,_),_=r.mul(z,j),C=r.mul(v,C),C=r.add(C,_),new l(P,R,C)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return m.wNAFCached(this,u,d,h=>{let b=r.invertBatch(h.map(y=>y.pz));return h.map((y,w)=>y.toAffine(b[w])).map(l.fromAffine)})}multiplyUnsafe(d){let h=l.ZERO;if(d===Ae)return h;if(a(d),d===re)return this;let{endo:b}=t;if(!b)return m.unsafeLadder(this,d);let{k1neg:y,k1:w,k2neg:g,k2:E}=b.splitScalar(d),P=h,R=h,C=this;for(;w>Ae||E>Ae;)w&re&&(P=P.add(C)),E&re&&(R=R.add(C)),C=C.double(),w>>=re,E>>=re;return y&&(P=P.negate()),g&&(R=R.negate()),R=new l(r.mul(R.px,b.beta),R.py,R.pz),P.add(R)}multiply(d){a(d);let h=d,b,y,{endo:w}=t;if(w){let{k1neg:g,k1:E,k2neg:P,k2:R}=w.splitScalar(h),{p:C,f:U}=this.wNAF(E),{p:O,f:_}=this.wNAF(R);C=m.constTimeNegate(g,C),O=m.constTimeNegate(P,O),O=new l(r.mul(O.px,w.beta),O.py,O.pz),b=C.add(O),y=U.add(_)}else{let{p:g,f:E}=this.wNAF(h);b=g,y=E}return l.normalizeZ([b,y])[0]}multiplyAndAddUnsafe(d,h,b){let y=l.BASE,w=(E,P)=>P===Ae||P===re||!E.equals(y)?E.multiplyUnsafe(P):E.multiply(P),g=w(this,h).add(w(d,b));return g.is0()?void 0:g}toAffine(d){let{px:h,py:b,pz:y}=this,w=this.is0();d==null&&(d=w?r.ONE:r.inv(y));let g=r.mul(h,d),E=r.mul(b,d),P=r.mul(y,d);if(w)return{x:r.ZERO,y:r.ZERO};if(!r.eql(P,r.ONE))throw new Error("invZ was invalid");return{x:g,y:E}}isTorsionFree(){let{h:d,isTorsionFree:h}=t;if(d===re)return!0;if(h)return h(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:d,clearCofactor:h}=t;return d===re?this:h?h(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),n(l,this,d)}toHex(d=!0){return J.bytesToHex(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,r.ONE),l.ZERO=new l(r.ZERO,r.ONE,r.ZERO);let p=t.nBitLength,m=(0,qn.wNAF)(l,t.endo?Math.ceil(p/2):p);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:i}}oe.weierstrassPoints=Qo;function Lu(e){let t=(0,qn.validateBasic)(e);return J.validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Mu(e){let t=Lu(e),{Fp:r,n}=t,s=r.BYTES+1,o=2*r.BYTES+1;function i(S){return Ae<S&&S<r.ORDER}function a(S){return Rt.mod(S,n)}function c(S){return Rt.invert(S,n)}let{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:l,isWithinCurveOrder:p}=Qo({...t,toBytes(S,v,T){let A=v.toAffine(),B=r.toBytes(A.x),k=J.concatBytes;return T?k(Uint8Array.from([v.hasEvenY()?2:3]),B):k(Uint8Array.from([4]),B,r.toBytes(A.y))},fromBytes(S){let v=S.length,T=S[0],A=S.subarray(1);if(v===s&&(T===2||T===3)){let B=J.bytesToNumberBE(A);if(!i(B))throw new Error("Point is not on curve");let k=l(B),$;try{$=r.sqrt(k)}catch(ce){let be=ce instanceof Error?": "+ce.message:"";throw new Error("Point is not on curve"+be)}let F=($&re)===re;return(T&1)===1!==F&&($=r.neg($)),{x:B,y:$}}else if(v===o&&T===4){let B=r.fromBytes(A.subarray(0,r.BYTES)),k=r.fromBytes(A.subarray(r.BYTES,2*r.BYTES));return{x:B,y:k}}else throw new Error(`Point of length ${v} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),m=S=>J.bytesToHex(J.numberToBytesBE(S,t.nByteLength));function x(S){let v=n>>re;return S>v}function d(S){return x(S)?a(-S):S}let h=(S,v,T)=>J.bytesToNumberBE(S.slice(v,T));class b{constructor(v,T,A){this.r=v,this.s=T,this.recovery=A,this.assertValidity()}static fromCompact(v){let T=t.nByteLength;return v=(0,De.ensureBytes)("compactSignature",v,T*2),new b(h(v,0,T),h(v,T,2*T))}static fromDER(v){let{r:T,s:A}=oe.DER.toSig((0,De.ensureBytes)("DER",v));return new b(T,A)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(v){return new b(this.r,this.s,v)}recoverPublicKey(v){let{r:T,s:A,recovery:B}=this,k=R((0,De.ensureBytes)("msgHash",v));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");let $=B===2||B===3?T+t.n:T;if($>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");let F=B&1?"03":"02",ae=u.fromHex(F+m($)),ce=c($),be=a(-k*ce),Ce=a(A*ce),xe=u.BASE.multiplyAndAddUnsafe(ae,be,Ce);if(!xe)throw new Error("point at infinify");return xe.assertValidity(),xe}hasHighS(){return x(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return J.hexToBytes(this.toDERHex())}toDERHex(){return oe.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return J.hexToBytes(this.toCompactHex())}toCompactHex(){return m(this.r)+m(this.s)}}let y={isValidPrivateKey(S){try{return f(S),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{let S=Rt.getMinHashLength(t.n);return Rt.mapHashToField(t.randomBytes(S),t.n)},precompute(S=8,v=u.BASE){return v._setWindowSize(S),v.multiply(BigInt(3)),v}};function w(S,v=!0){return u.fromPrivateKey(S).toRawBytes(v)}function g(S){let v=J.isBytes(S),T=typeof S=="string",A=(v||T)&&S.length;return v?A===s||A===o:T?A===2*s||A===2*o:S instanceof u}function E(S,v,T=!0){if(g(S))throw new Error("first arg must be private key");if(!g(v))throw new Error("second arg must be public key");return u.fromHex(v).multiply(f(S)).toRawBytes(T)}let P=t.bits2int||function(S){let v=J.bytesToNumberBE(S),T=S.length*8-t.nBitLength;return T>0?v>>BigInt(T):v},R=t.bits2int_modN||function(S){return a(P(S))},C=J.bitMask(t.nBitLength);function U(S){if(typeof S!="bigint")throw new Error("bigint expected");if(!(Ae<=S&&S<C))throw new Error(`bigint expected < 2^${t.nBitLength}`);return J.numberToBytesBE(S,t.nByteLength)}function O(S,v,T=_){if(["recovered","canonical"].some(Ee=>Ee in T))throw new Error("sign() legacy options not supported");let{hash:A,randomBytes:B}=t,{lowS:k,prehash:$,extraEntropy:F}=T;k==null&&(k=!0),S=(0,De.ensureBytes)("msgHash",S),$&&(S=(0,De.ensureBytes)("prehashed msgHash",A(S)));let ae=R(S),ce=f(v),be=[U(ce),U(ae)];if(F!=null&&F!==!1){let Ee=F===!0?B(r.BYTES):F;be.push((0,De.ensureBytes)("extraEntropy",Ee))}let Ce=J.concatBytes(...be),xe=ae;function Oe(Ee){let ut=P(Ee);if(!p(ut))return;let ms=c(ut),Le=u.BASE.multiply(ut).toAffine(),ft=a(Le.x);if(ft===Ae)return;let Ht=a(ms*a(xe+ft*ce));if(Ht===Ae)return;let bs=(Le.x===ft?0:2)|Number(Le.y&re),xs=Ht;return k&&x(Ht)&&(xs=d(Ht),bs^=1),new b(ft,xs,bs)}return{seed:Ce,k2sig:Oe}}let _={lowS:t.lowS,prehash:!1},j={lowS:t.lowS,prehash:!1};function H(S,v,T=_){let{seed:A,k2sig:B}=O(S,v,T),k=t;return J.createHmacDrbg(k.hash.outputLen,k.nByteLength,k.hmac)(A,B)}u.BASE._setWindowSize(8);function z(S,v,T,A=j){let B=S;if(v=(0,De.ensureBytes)("msgHash",v),T=(0,De.ensureBytes)("publicKey",T),"strict"in A)throw new Error("options.strict was renamed to lowS");let{lowS:k,prehash:$}=A,F,ae;try{if(typeof B=="string"||J.isBytes(B))try{F=b.fromDER(B)}catch(Le){if(!(Le instanceof oe.DER.Err))throw Le;F=b.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){let{r:Le,s:ft}=B;F=new b(Le,ft)}else throw new Error("PARSE");ae=u.fromHex(T)}catch(Le){if(Le.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(k&&F.hasHighS())return!1;$&&(v=t.hash(v));let{r:ce,s:be}=F,Ce=R(v),xe=c(be),Oe=a(Ce*xe),Ee=a(ce*xe),ut=u.BASE.multiplyAndAddUnsafe(ae,Oe,Ee)?.toAffine();return ut?a(ut.x)===ce:!1}return{CURVE:t,getPublicKey:w,getSharedSecret:E,sign:H,verify:z,ProjectivePoint:u,Signature:b,utils:y}}oe.weierstrass=Mu;function ei(e,t){let r=e.ORDER,n=Ae;for(let x=r-re;x%Je===Ae;x/=Je)n+=re;let s=n,o=Je<<s-re-re,i=o*Je,a=(r-re)/i,c=(a-re)/Je,u=i-re,f=o,l=e.pow(t,a),p=e.pow(t,(a+re)/Je),m=(x,d)=>{let h=l,b=e.pow(d,u),y=e.sqr(b);y=e.mul(y,d);let w=e.mul(x,y);w=e.pow(w,c),w=e.mul(w,b),b=e.mul(w,d),y=e.mul(w,x);let g=e.mul(y,b);w=e.pow(g,f);let E=e.eql(w,e.ONE);b=e.mul(y,p),w=e.mul(g,h),y=e.cmov(b,y,E),g=e.cmov(w,g,E);for(let P=s;P>re;P--){let R=P-Je;R=Je<<R-re;let C=e.pow(g,R),U=e.eql(C,e.ONE);b=e.mul(y,h),h=e.mul(h,h),C=e.mul(g,h),y=e.cmov(b,y,U),g=e.cmov(C,g,U)}return{isValid:E,value:y}};if(e.ORDER%Jo===dr){let x=(e.ORDER-dr)/Jo,d=e.sqrt(e.neg(t));m=(h,b)=>{let y=e.sqr(b),w=e.mul(h,b);y=e.mul(y,w);let g=e.pow(y,x);g=e.mul(g,w);let E=e.mul(g,d),P=e.mul(e.sqr(g),b),R=e.eql(P,h),C=e.cmov(E,g,R);return{isValid:R,value:C}}}return m}oe.SWUFpSqrtRatio=ei;function Uu(e,t){if(Rt.validateField(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");let r=ei(e,t.Z);if(!e.isOdd)throw new Error("Fp.isOdd is not implemented!");return n=>{let s,o,i,a,c,u,f,l;s=e.sqr(n),s=e.mul(s,t.Z),o=e.sqr(s),o=e.add(o,s),i=e.add(o,e.ONE),i=e.mul(i,t.B),a=e.cmov(t.Z,e.neg(o),!e.eql(o,e.ZERO)),a=e.mul(a,t.A),o=e.sqr(i),u=e.sqr(a),c=e.mul(u,t.A),o=e.add(o,c),o=e.mul(o,i),u=e.mul(u,a),c=e.mul(u,t.B),o=e.add(o,c),f=e.mul(s,i);let{isValid:p,value:m}=r(o,u);l=e.mul(s,n),l=e.mul(l,m),f=e.cmov(f,i,p),l=e.cmov(l,m,p);let x=e.isOdd(n)===e.isOdd(l);return l=e.cmov(e.neg(l),l,x),f=e.div(f,a),{x:f,y:l}}}oe.mapToCurveSimpleSWU=Uu});var ni=K(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.createHasher=_e.isogenyMap=_e.hash_to_field=_e.expand_message_xof=_e.expand_message_xmd=void 0;var Du=Lt(),pe=rt(),ku=pe.bytesToNumberBE;function Qe(e,t){if(e<0||e>=1<<8*t)throw new Error(`bad I2OSP call: value=${e} length=${t}`);let r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=e&255,e>>>=8;return new Uint8Array(r)}function ju(e,t){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function Ln(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function ti(e,t,r,n){(0,pe.abytes)(e),(0,pe.abytes)(t),Ln(r),t.length>255&&(t=n((0,pe.concatBytes)((0,pe.utf8ToBytes)("H2C-OVERSIZE-DST-"),t)));let{outputLen:s,blockLen:o}=n,i=Math.ceil(r/s);if(i>255)throw new Error("Invalid xmd length");let a=(0,pe.concatBytes)(t,Qe(t.length,1)),c=Qe(0,o),u=Qe(r,2),f=new Array(i),l=n((0,pe.concatBytes)(c,e,u,Qe(0,1),a));f[0]=n((0,pe.concatBytes)(l,Qe(1,1),a));for(let m=1;m<=i;m++){let x=[ju(l,f[m-1]),Qe(m+1,1),a];f[m]=n((0,pe.concatBytes)(...x))}return(0,pe.concatBytes)(...f).slice(0,r)}_e.expand_message_xmd=ti;function ri(e,t,r,n,s){if((0,pe.abytes)(e),(0,pe.abytes)(t),Ln(r),t.length>255){let o=Math.ceil(2*n/8);t=s.create({dkLen:o}).update((0,pe.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return s.create({dkLen:r}).update(e).update(Qe(r,2)).update(t).update(Qe(t.length,1)).digest()}_e.expand_message_xof=ri;function On(e,t,r){(0,pe.validateObject)(r,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});let{p:n,k:s,m:o,hash:i,expand:a,DST:c}=r;(0,pe.abytes)(e),Ln(t);let u=typeof c=="string"?(0,pe.utf8ToBytes)(c):c,f=n.toString(2).length,l=Math.ceil((f+s)/8),p=t*o*l,m;if(a==="xmd")m=ti(e,u,p,i);else if(a==="xof")m=ri(e,u,p,s,i);else if(a==="_internal_pass")m=e;else throw new Error('expand must be "xmd" or "xof"');let x=new Array(t);for(let d=0;d<t;d++){let h=new Array(o);for(let b=0;b<o;b++){let y=l*(b+d*o),w=m.subarray(y,y+l);h[b]=(0,Du.mod)(ku(w),n)}x[d]=h}return x}_e.hash_to_field=On;function Hu(e,t){let r=t.map(n=>Array.from(n).reverse());return(n,s)=>{let[o,i,a,c]=r.map(u=>u.reduce((f,l)=>e.add(e.mul(f,n),l)));return n=e.div(o,i),s=e.mul(s,e.div(a,c)),{x:n,y:s}}}_e.isogenyMap=Hu;function Fu(e,t,r){if(typeof t!="function")throw new Error("mapToCurve() must be defined");return{hashToCurve(n,s){let o=On(n,2,{...r,DST:r.DST,...s}),i=e.fromAffine(t(o[0])),a=e.fromAffine(t(o[1])),c=i.add(a).clearCofactor();return c.assertValidity(),c},encodeToCurve(n,s){let o=On(n,1,{...r,DST:r.encodeDST,...s}),i=e.fromAffine(t(o[0])).clearCofactor();return i.assertValidity(),i}}}_e.createHasher=Fu});var ii=K(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.createCurve=St.getHash=void 0;var $u=an(),si=Me(),Vu=An();function oi(e){return{hash:e,hmac:(t,...r)=>(0,$u.hmac)(e,t,(0,si.concatBytes)(...r)),randomBytes:si.randomBytes}}St.getHash=oi;function zu(e,t){let r=n=>(0,Vu.weierstrass)({...e,...oi(n)});return Object.freeze({...r(t),create:r})}St.createCurve=zu});var mi=K(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.encodeToCurve=Se.hashToCurve=Se.schnorr=Se.secp256k1=void 0;var hr=Lo(),Ku=Me(),ue=Lt(),Zu=An(),ge=rt(),ui=ni(),Wu=ii(),mr=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),pr=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),fi=BigInt(1),gr=BigInt(2),ai=(e,t)=>(e+t/gr)/t;function li(e){let t=mr,r=BigInt(3),n=BigInt(6),s=BigInt(11),o=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,f=u*u*e%t,l=(0,ue.pow2)(f,r,t)*f%t,p=(0,ue.pow2)(l,r,t)*f%t,m=(0,ue.pow2)(p,gr,t)*u%t,x=(0,ue.pow2)(m,s,t)*m%t,d=(0,ue.pow2)(x,o,t)*x%t,h=(0,ue.pow2)(d,a,t)*d%t,b=(0,ue.pow2)(h,c,t)*h%t,y=(0,ue.pow2)(b,a,t)*d%t,w=(0,ue.pow2)(y,r,t)*f%t,g=(0,ue.pow2)(w,i,t)*x%t,E=(0,ue.pow2)(g,n,t)*u%t,P=(0,ue.pow2)(E,gr,t);if(!et.eql(et.sqr(P),e))throw new Error("Cannot find square root");return P}var et=(0,ue.Field)(mr,void 0,void 0,{sqrt:li});Se.secp256k1=(0,Wu.createCurve)({a:BigInt(0),b:BigInt(7),Fp:et,n:pr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=pr,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-fi*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=r,i=BigInt("0x100000000000000000000000000000000"),a=ai(o*e,t),c=ai(-n*e,t),u=(0,ue.mod)(e-a*r-c*s,t),f=(0,ue.mod)(-a*n-c*o,t),l=u>i,p=f>i;if(l&&(u=t-u),p&&(f=t-f),u>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:u,k2neg:p,k2:f}}}},hr.sha256);var br=BigInt(0),di=e=>typeof e=="bigint"&&br<e&&e<mr,Gu=e=>typeof e=="bigint"&&br<e&&e<pr,ci={};function yr(e,...t){let r=ci[e];if(r===void 0){let n=(0,hr.sha256)(Uint8Array.from(e,s=>s.charCodeAt(0)));r=(0,ge.concatBytes)(n,n),ci[e]=r}return(0,hr.sha256)((0,ge.concatBytes)(r,...t))}var kn=e=>e.toRawBytes(!0).slice(1),Un=e=>(0,ge.numberToBytesBE)(e,32),Mn=e=>(0,ue.mod)(e,mr),Mt=e=>(0,ue.mod)(e,pr),jn=Se.secp256k1.ProjectivePoint,Yu=(e,t,r)=>jn.BASE.multiplyAndAddUnsafe(e,t,r);function Dn(e){let t=Se.secp256k1.utils.normPrivateKeyToScalar(e),r=jn.fromPrivateKey(t);return{scalar:r.hasEvenY()?t:Mt(-t),bytes:kn(r)}}function hi(e){if(!di(e))throw new Error("bad x: need 0 < x < p");let t=Mn(e*e),r=Mn(t*e+BigInt(7)),n=li(r);n%gr!==br&&(n=Mn(-n));let s=new jn(e,n,fi);return s.assertValidity(),s}function pi(...e){return Mt((0,ge.bytesToNumberBE)(yr("BIP0340/challenge",...e)))}function Xu(e){return Dn(e).bytes}function Ju(e,t,r=(0,Ku.randomBytes)(32)){let n=(0,ge.ensureBytes)("message",e),{bytes:s,scalar:o}=Dn(t),i=(0,ge.ensureBytes)("auxRand",r,32),a=Un(o^(0,ge.bytesToNumberBE)(yr("BIP0340/aux",i))),c=yr("BIP0340/nonce",a,s,n),u=Mt((0,ge.bytesToNumberBE)(c));if(u===br)throw new Error("sign failed: k is zero");let{bytes:f,scalar:l}=Dn(u),p=pi(f,s,n),m=new Uint8Array(64);if(m.set(f,0),m.set(Un(Mt(l+p*o)),32),!gi(m,n,s))throw new Error("sign: Invalid signature produced");return m}function gi(e,t,r){let n=(0,ge.ensureBytes)("signature",e,64),s=(0,ge.ensureBytes)("message",t),o=(0,ge.ensureBytes)("publicKey",r,32);try{let i=hi((0,ge.bytesToNumberBE)(o)),a=(0,ge.bytesToNumberBE)(n.subarray(0,32));if(!di(a))return!1;let c=(0,ge.bytesToNumberBE)(n.subarray(32,64));if(!Gu(c))return!1;let u=pi(Un(a),kn(i),s),f=Yu(i,c,Mt(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==a)}catch{return!1}}Se.schnorr={getPublicKey:Xu,sign:Ju,verify:gi,utils:{randomPrivateKey:Se.secp256k1.utils.randomPrivateKey,lift_x:hi,pointToBytes:kn,numberToBytesBE:ge.numberToBytesBE,bytesToNumberBE:ge.bytesToNumberBE,taggedHash:yr,mod:ue.mod}};var Qu=(0,ui.isogenyMap)(et,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(t=>BigInt(t)))),ef=(0,Zu.mapToCurveSimpleSWU)(et,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:et.create(BigInt("-11"))}),yi=(0,ui.createHasher)(Se.secp256k1.ProjectivePoint,e=>{let{x:t,y:r}=ef(et.create(e[0]));return Qu(t,r)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:et.ORDER,m:1,k:128,expand:"xmd",hash:hr.sha256});Se.hashToCurve=yi.hashToCurve;Se.encodeToCurve=yi.encodeToCurve});var Kn=K(W=>{"use strict";var tf=W&&W.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),rf=W&&W.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),nf=W&&W.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&tf(t,e,r);return rf(t,e),t};Object.defineProperty(W,"__esModule",{value:!0});W.isError=W.isOk=W.unboxResponse=W.boxResponse=W.unboxRequest=W.boxRequest=W.uHTTP_CRYPTO_VERSION=W.ResState=void 0;var Hn=nf(Fs()),xi=Me(),Fn=go(),sf=Ao(),Vn=mi(),Y;(function(e){e[e.Ok=0]="Ok",e[e.Failed=1]="Failed"})(Y||(W.ResState=Y={}));W.uHTTP_CRYPTO_VERSION=33;var nt=33,st=8,wi=16,of=32,bi=12,af=32,cf="req",uf="resp";function zn(e){let t=new Uint8Array(8);for(let r=7;r>=0;r--)t[r]=Number(e&0xffn),e=e>>8n;return t}function Ei(e){let t=0n;for(let r=0;r<e.length;r++)t=t<<8n|BigInt(e[r]);return t}function $n(){let e={dkLen:af},t=Fn.blake2s.create(e),r=n=>Fn.blake2s.create(e).update((0,xi.toBytes)(n)).digest();return r.outputLen=t.outputLen,r.blockLen=t.blockLen,r.create=()=>Fn.blake2s.create(e),r}function xr(e,t,r,n,s){let o=n?0:2,i=n?cf:uf,a=new TextEncoder,c=new Uint8Array(1+r.length+i.length);c[0]=W.uHTTP_CRYPTO_VERSION,c.set(a.encode(r),1),c.set(a.encode(i),r.length+1);let u=Hn.extract($n(),e,c),f=of,l=new Uint8Array(1);l[0]=o;let p=Hn.expand($n(),u,l,f);l[0]=o+1;let m=bi-st,x=Hn.expand($n(),u,l,m),d=new Uint8Array(bi);return d.set(x,0),d.set(zn(t),m),(0,sf.chacha20poly1305)(p,d,a.encode(s))}function ff(e){let t=e(32),r=Vn.secp256k1.getPublicKey(t);if(r.length!==nt)throw new Error("key size mismatch");return{pubKey:r,privKey:t}}function lf({message:e,uuid:t,counterOffset:r,exitPeerId:n,exitPublicKey:s},o=xi.randomBytes){if(s.length!==nt)return{res:Y.Failed,error:"incorrect public key size"};let i,a;try{i=ff(o),a=Vn.secp256k1.getSharedSecret(i.privKey,s).slice(1)}catch(x){return{res:Y.Failed,error:`ecdh failed ${x}`}}let c=BigInt(Date.now()+1+r),u;try{u=xr(a,c,n,!0,t)}catch(x){return{res:Y.Failed,error:`failed to initialize cipher: ${x}`}}let f;try{f=u.encrypt(e)}catch(x){return{res:Y.Failed,error:`failed to encrypt data: ${x}`}}let l=zn(c),p=new Uint8Array([W.uHTTP_CRYPTO_VERSION]),m=new Uint8Array(p.length+i.pubKey.length+l.length+f.length);return m.set(p,0),m.set(i.pubKey,p.length),m.set(l,p.length+i.pubKey.length),m.set(f,p.length+i.pubKey.length+l.length),{res:Y.Ok,session:{request:new Uint8Array(m),updatedTS:c,sharedPreSecret:a}}}W.boxRequest=lf;function df({message:e,uuid:t,exitPeerId:r,exitPrivateKey:n}){if((e[0]&16)!=(W.uHTTP_CRYPTO_VERSION&16))return{res:Y.Failed,error:"unsupported protocol version"};if(e.length<=1+nt+st+wi)return{res:Y.Failed,error:"invalid message size"};if(!n)return{res:Y.Failed,error:"missing private key"};let s;try{let f=e.slice(1,nt+1);s=Vn.secp256k1.getSharedSecret(n,f).slice(1)}catch(f){return{res:Y.Failed,error:`ecdh failed: ${f}`}}let o=e.slice(1+nt,1+nt+st),i=Ei(o),a;try{a=xr(s,i,r,!0,t)}catch(f){return{res:Y.Failed,error:`failed to initialize cipher: ${f}`}}let c;try{c=a.decrypt(e.slice(1+nt+st))}catch(f){return{res:Y.Failed,error:`decryption failed: ${f}`}}let u={request:c,updatedTS:i,sharedPreSecret:s};return{res:Y.Ok,session:u}}W.unboxRequest=df;function hf(e,{entryPeerId:t,uuid:r,message:n}){let s=e.sharedPreSecret;if(!s)return{res:Y.Failed,error:"invalid session"};let o=BigInt(Date.now()+1),i;try{i=xr(s,o,t,!1,r)}catch(f){return{res:Y.Failed,error:`failed to initialize cipher: ${f}`}}let a;try{a=i.encrypt(n)}catch(f){return{res:Y.Failed,error:`failed to encrypt data: ${f}`}}let c=zn(o),u=new Uint8Array(c.length+a.length);return u.set(c,0),u.set(a,c.length),e.response=u,e.updatedTS=o,{res:Y.Ok,session:e}}W.boxResponse=hf;function pf(e,{entryPeerId:t,uuid:r,message:n}){let s=e.sharedPreSecret;if(!s)return{res:Y.Failed,error:"invalid session"};if(n.length<=st+wi)return{res:Y.Failed,error:"invalid message size"};let o=n.slice(0,st),i=Ei(o),a;try{a=xr(s,i,t,!1,r)}catch(u){return{res:Y.Failed,error:`failed to initialize cipher: ${u}`}}let c;try{c=a.decrypt(n.slice(st))}catch(u){return{res:Y.Failed,error:`decryption failed: ${u}`}}return e.response=c,e.updatedTS=i,{res:Y.Ok,session:e}}W.unboxResponse=pf;function gf(e){return e.res==Y.Ok}W.isOk=gf;function yf(e){return e.res==Y.Failed}W.isError=yf});var Mi=K((Tl,Li)=>{var vt=1e3,Bt=vt*60,It=Bt*60,at=It*24,vf=at*7,Bf=at*365.25;Li.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return If(e);if(r==="number"&&isFinite(e))return t.long?Tf(e):Cf(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function If(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Bf;case"weeks":case"week":case"w":return r*vf;case"days":case"day":case"d":return r*at;case"hours":case"hour":case"hrs":case"hr":case"h":return r*It;case"minutes":case"minute":case"mins":case"min":case"m":return r*Bt;case"seconds":case"second":case"secs":case"sec":case"s":return r*vt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Cf(e){var t=Math.abs(e);return t>=at?Math.round(e/at)+"d":t>=It?Math.round(e/It)+"h":t>=Bt?Math.round(e/Bt)+"m":t>=vt?Math.round(e/vt)+"s":e+"ms"}function Tf(e){var t=Math.abs(e);return t>=at?Ir(e,t,at,"day"):t>=It?Ir(e,t,It,"hour"):t>=Bt?Ir(e,t,Bt,"minute"):t>=vt?Ir(e,t,vt,"second"):e+" ms"}function Ir(e,t,r,n){var s=t>=r*1.5;return Math.round(e/r)+" "+n+(s?"s":"")}});var Di=K((_l,Ui)=>{function _f(e){r.debug=r,r.default=r,r.coerce=c,r.disable=o,r.enable=s,r.enabled=i,r.humanize=Mi(),r.destroy=u,Object.keys(e).forEach(f=>{r[f]=e[f]}),r.names=[],r.skips=[],r.formatters={};function t(f){let l=0;for(let p=0;p<f.length;p++)l=(l<<5)-l+f.charCodeAt(p),l|=0;return r.colors[Math.abs(l)%r.colors.length]}r.selectColor=t;function r(f){let l,p=null,m,x;function d(...h){if(!d.enabled)return;let b=d,y=Number(new Date),w=y-(l||y);b.diff=w,b.prev=l,b.curr=y,l=y,h[0]=r.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let g=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(P,R)=>{if(P==="%%")return"%";g++;let C=r.formatters[R];if(typeof C=="function"){let U=h[g];P=C.call(b,U),h.splice(g,1),g--}return P}),r.formatArgs.call(b,h),(b.log||r.log).apply(b,h)}return d.namespace=f,d.useColors=r.useColors(),d.color=r.selectColor(f),d.extend=n,d.destroy=r.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(m!==r.namespaces&&(m=r.namespaces,x=r.enabled(f)),x),set:h=>{p=h}}),typeof r.init=="function"&&r.init(d),d}function n(f,l){let p=r(this.namespace+(typeof l>"u"?":":l)+f);return p.log=this.log,p}function s(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let l,p=(typeof f=="string"?f:"").split(/[\s,]+/),m=p.length;for(l=0;l<m;l++)p[l]&&(f=p[l].replace(/\*/g,".*?"),f[0]==="-"?r.skips.push(new RegExp("^"+f.slice(1)+"$")):r.names.push(new RegExp("^"+f+"$")))}function o(){let f=[...r.names.map(a),...r.skips.map(a).map(l=>"-"+l)].join(",");return r.enable(""),f}function i(f){if(f[f.length-1]==="*")return!0;let l,p;for(l=0,p=r.skips.length;l<p;l++)if(r.skips[l].test(f))return!1;for(l=0,p=r.names.length;l<p;l++)if(r.names[l].test(f))return!0;return!1}function a(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function c(f){return f instanceof Error?f.stack||f.message:f}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Ui.exports=_f});var ki=K((Ie,Cr)=>{Ie.formatArgs=qf;Ie.save=Af;Ie.load=Of;Ie.useColors=Nf;Ie.storage=Lf();Ie.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Ie.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Nf(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function qf(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Cr.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),e.splice(n,0,t)}Ie.log=console.debug||console.log||(()=>{});function Af(e){try{e?Ie.storage.setItem("debug",e):Ie.storage.removeItem("debug")}catch{}}function Of(){let e;try{e=Ie.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function Lf(){try{return localStorage}catch{}}Cr.exports=Di()(Ie);var{formatters:Mf}=Cr.exports;Mf.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var Lr={};Pe(Lr,{NoMoreNodes:()=>_t,Unauthorized:()=>Vt,getNodes:()=>Or,postQuota:()=>ba});var _t="no more nodes",Vt="unauthorized";function Or(e,t){let r=new URL("/api/v1/nodes/pairings",e.discoveryPlatformEndpoint);r.searchParams.set("amount",`${t}`),r.searchParams.set("force_zero_hop",`${e.forceZeroHop}`),e.clientAssociated!==void 0&&r.searchParams.set("client_associated",`${e.clientAssociated}`);let n={Accept:"application/json","Content-Type":"application/json","x-rpch-client":e.clientId};return e.pinnedFetch(r,{headers:n,signal:AbortSignal.timeout(3e4)}).then(s=>{switch(s.status){case 204:throw new Error(_t);case 403:throw new Error(Vt);default:return s.json()}})}function ba(e,{clientId:t,domain:r,segmentCount:n,rpcMethod:s,type:o,lastSegmentLength:i,chainId:a}){let c=new URL(`/api/v1/quota/${o}`,e.discoveryPlatformEndpoint),u={Accept:"application/json","Content-Type":"application/json","x-rpch-node":e.nodeAccessToken},f=JSON.stringify({clientId:t,segmentCount:n,rpcMethod:s,lastSegmentLength:i,chainId:a,domain:r});return new Promise((l,p)=>{e.pinnedFetch(c,{headers:u,method:"POST",body:f,signal:AbortSignal.timeout(3e4)}).then(m=>m.status===204?l():p(`Unexpected response code: ${m.status}`)).catch(m=>p(m))})}var Rs={};Pe(Rs,{fetchUrl:()=>wa});async function wa(e,t,r){let n=new URL(t),s=r?.body,o=Sa(r?.method),i=Ra(n,r?.headers,s),a=r?.timeout??5e3;return e(n,{headers:i,method:o,body:s,signal:AbortSignal.timeout(a)}).then(async c=>{let u=c.status,f=c.statusText,l=Ea(c.headers);if(c.body){let p=await c.arrayBuffer(),m=Array.from(new Uint8Array(p));return{status:u,statusText:f,headers:l,data:m}}return{status:u,statusText:f,headers:l}})}function Ea(e){let t={};for(let[r,n]of e.entries())t[r]=n;return t}function Ra(e,t,r){if(!t)return t;let n=Pa(t);if(n.has("host")&&n.set("host",["Host",e.host]),n.has("content-length")){let s=r?.length??0;n.set("content-length",["Content-Length",`${s}`])}return Array.from(n.values()).reduce((s,[o,i])=>(s[o]=i,s),{})}function Sa(e){let t=e?.toUpperCase().trim();return t==="POST"||t==="PUT"||t==="PATCH"||t==="DELETE"?t:"GET"}function Pa(e){return Object.entries(e).reduce((t,[r,n])=>{let s=r.trim().toLowerCase();if(s.length===0)return t;if(!t.has(s))return t.set(s,[r,n]),t;let[o,i]=t.get(s);if(i.includes(n))return t;let a=`${i}, ${n}`,c=o.charAt(0)===o.charAt(0).toUpperCase()?o:r;return t.set(s,[c,a]),t},new Map)}var va={};var Fr={};Pe(Fr,{prettyPrint:()=>Hr});var Ne={};Pe(Ne,{VrsnCmp:()=>Ps,average:()=>Ve,base64ToBytes:()=>Dr,bytesToBase64:()=>Ur,bytesToString:()=>Nt,concatBytes:()=>kr,headersToRecord:()=>jr,hexStringToBytes:()=>Zt,isValidURL:()=>_a,randomEl:()=>zt,randomIdx:()=>Kt,randomWeightedIdx:()=>Mr,shortPeerId:()=>ne,stringToBytes:()=>lt,versionCompare:()=>Na});var ke={};Pe(ke,{assertErr:()=>Ia,assertOk:()=>Ba,err:()=>te,isErr:()=>he,isOk:()=>Ss,ok:()=>ee});function ee(e){return{success:!0,res:e}}function te(e){return{success:!1,error:e}}function Ss(e){return e.success}function he(e){return!e.success}function Ba(e){if(he(e))throw new Error("expected ResultOk - got ResultErr")}function Ia(e){if(Ss(e))throw new Error("expected ResultErr - got ResultOk")}var Ca=new TextDecoder,Ta=new TextEncoder,Ps=(s=>(s[s.Identical=0]="Identical",s[s.PatchMismatch=1]="PatchMismatch",s[s.MinorMismatch=2]="MinorMismatch",s[s.MajorMismatch=3]="MajorMismatch",s))(Ps||{});function ne(e){return`.${e.substring(e.length-4)}`}function zt(e){return e[Kt(e)]}function Mr(e){let t=e.reduce((s,o)=>s+o,0),r=Math.random()*t,n=0;for(let s=0;s<e.length;s++)if(n+=e[s],n>r)return s;return e.length-1}function Kt(e){return Math.floor(Math.random()*e.length)}function Ve(e){return e.reduce((r,n)=>r+n,0)/e.length||0}function _a(e){if("canParse"in URL)return URL.canParse(e);try{return new URL(e),!0}catch{return!1}}function lt(e){return Ta.encode(e)}function Ur(e){let t=Array.from(e,r=>String.fromCodePoint(r));return btoa(t.join(""))}function Dr(e){try{let t=atob(e),r=Uint8Array.from(t,n=>n.codePointAt(0));return ee(r)}catch(t){return te(t.toString())}}function Nt(e){return Ca.decode(e)}function kr(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function jr(e){return Object.entries(e).reduce((t,[r,n])=>(n&&(Array.isArray(n)?t[r]=n.join(", "):t[r]=n),t),{})}function Zt(e){e=e.startsWith("0x")?e.slice(2):e,e.length%2!==0&&(e="0"+e);let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t}function Na(e,t){let r=e.split(".");if(r.length<3)return te("invalid ref");let n=t.split(".");if(n.length<3)return te("invalid version");let[s,o,i]=r,[a,c,u]=n;return parseInt(s,10)!==parseInt(a,10)?ee(3):parseInt(o,10)!==parseInt(c,10)?ee(2):parseInt(i,10)!==parseInt(u,10)?ee(1):ee(0)}function Hr(e,t,r,n){let o=[`x${ne(e)}`,`v${t}`,`c:${r}`];return n&&o.push(`r:${n.length}`),`ExitNode[${o.join(",")}]`}var Wt={};Pe(Wt,{accountAddresses:()=>Ma,connectWS:()=>Oa,deleteMessages:()=>La,getAllChannels:()=>Ua,getNodeChannels:()=>Kr,getPeers:()=>zr,isError:()=>Zr,retrieveMessages:()=>Vr,sendMessage:()=>ht,version:()=>$r});var Aa=(Bs(),ma(vs));function Oa(e){let t=new URL("/api/v3/messages/websocket",e.apiEndpoint);return t.protocol=e.apiEndpoint.protocol==="https:"?"wss:":"ws:",t.search=`?apiToken=${e.accessToken}`,new Aa(t)}async function ht(e,{recipient:t,tag:r,message:n}){let s=new URL("/api/v3/messages",e.apiEndpoint),o={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken},i={body:n,peerId:t,tag:r};e.hops===0?i.path=[]:e.relay?i.path=[e.relay]:i.hops=1;let a=JSON.stringify(i),c=await e.pinnedFetch(s,{method:"POST",headers:o,body:a});if(c.ok)return c.json();let u=await c.text();throw new Error(`Error sending message [${c.status}]: ${u}`)}function $r(e){let t=new URL("/api/v3/node/version",e.apiEndpoint),r={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken};return e.pinnedFetch(t,{headers:r}).then(n=>n.json())}function Vr(e,t){let r=new URL("/api/v3/messages/pop-all",e.apiEndpoint),n={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken},s=JSON.stringify({tag:t});return e.pinnedFetch(r,{method:"POST",headers:n,body:s}).then(o=>o.json())}function La(e,t){let r=new URL("/api/v3/messages",e.apiEndpoint);r.searchParams.set("tag",`${t}`);let n={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken};return new Promise((s,o)=>e.pinnedFetch(r,{method:"DELETE",headers:n}).then(i=>i.status===204?s():o(`Unexpected response status code: ${i.status}`)))}function Ma(e){let t=new URL("/api/v3/account/addresses",e.apiEndpoint),r={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken};return e.pinnedFetch(t,{headers:r}).then(n=>{if(n.ok)return n.json();throw new Error(`Unexpected response status code: ${n.status}`)})}function zr(e){let t=new URL("/api/v3/node/peers",e.apiEndpoint);t.searchParams.set("quality","1");let r={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken};return e.pinnedFetch(t,{headers:r}).then(n=>n.json())}function Ua(e){let t=new URL("/api/v3/channels",e.apiEndpoint);t.searchParams.set("fullTopology","true");let r={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken};return e.pinnedFetch(t,{headers:r}).then(n=>n.json())}function Kr(e){let t=new URL("/api/v3/channels",e.apiEndpoint),r={Accept:"application/json","Content-Type":"application/json","x-auth-token":e.accessToken};return e.pinnedFetch(t,{headers:r}).then(n=>n.json())}function Zr(e){return"error"in e}var pt={};Pe(pt,{RespType:()=>Yr,decodeInfo:()=>tn,decodeReq:()=>Jr,decodeResp:()=>en,encodeInfo:()=>Da,encodeReq:()=>Xr,encodeResp:()=>Qr});var Gr=$t(Is());var Yr=(s=>(s[s.Resp=0]="Resp",s[s.CounterFail=1]="CounterFail",s[s.DuplicateFail=2]="DuplicateFail",s[s.Error=3]="Error",s))(Yr||{});function Xr(e){let t=ka(e);return ee(t)}function Jr(e){return ee(Fa(e))}function Qr(e){let t=ja(e);return ee(t)}function en(e){return ee($a(e))}function Da(e){let t=Ha(e);try{let r=Gr.default.compressToUTF16(JSON.stringify(t));return ee(r)}catch(r){return te(`Error encoding info payload: ${r}`)}}function tn(e){try{let t=JSON.parse(Gr.default.decompressFromUTF16(e));return ee(Va(t))}catch(t){return te(`Error decoding info payload: ${t}`)}}function ka(e){let t={c:e.clientId,e:e.endpoint};return e.body&&(t.b=e.body),e.headers&&(t.h=e.headers),e.method&&(t.m=e.method),e.timeout!=null&&e.timeout>=0&&(t.t=e.timeout),e.hops!=null&&e.hops>=0&&(t.n=e.hops),e.relayPeerId&&(t.r=e.relayPeerId),e.withDuration&&(t.w=e.withDuration),e.chainId&&(t.i=e.chainId),t}function ja(e){switch(e.type){case 0:{let t={t:0,h:e.headers,s:e.status,a:e.statusText};return e.data&&(t.d=e.data),e.callDuration!=null&&e.callDuration>=0&&(t.f=e.callDuration),e.exitAppDuration!=null&&e.exitAppDuration>=0&&(t.e=e.exitAppDuration),t}case 1:return{t:1,c:e.counter};case 2:return{t:2};case 3:return{t:3,r:e.reason}}}function Ha(e){let t={i:e.peerId,v:e.version,c:e.counter};return e.relayShortIds&&(t.r=e.relayShortIds),t}function Fa(e){let t={clientId:e.c,endpoint:e.e};return e.b&&(t.body=e.b),e.h&&(t.headers=e.h),e.m&&(t.method=e.m),e.t!=null&&e.t>=0&&(t.timeout=e.t),e.n!=null&&e.n>=0&&(t.hops=e.n),e.r&&(t.relayPeerId=e.r),e.w&&(t.withDuration=e.w),e.i&&(t.chainId=e.i),t}function $a(e){switch(e.t){case 0:{let t={type:0,headers:e.h,status:e.s,statusText:e.a};return e.d&&(t.data=e.d),e.f!=null&&e.f>=0&&(t.callDuration=e.f),e.e!=null&&e.e>=0&&(t.exitAppDuration=e.e),t}case 1:return{type:1,counter:e.c};case 2:return{type:2};case 3:return{type:3,reason:e.r}}}function Va(e){return{peerId:e.i,version:e.v,counter:e.c,relayShortIds:e.r}}var Dt={};Pe(Dt,{create:()=>Rr,messageToReq:()=>bf,prettyPrint:()=>me,toSegments:()=>Sr});var ot=$t(Kn());var Pt={};Pe(Pt,{MaxSegmentBody:()=>mf,fromMessage:()=>Wn,id:()=>Ut,prettyPrint:()=>ye,toMessage:()=>Er,toSegments:()=>Zn});var wr=400,mf=wr-17;function Zn(e,t){let r=Ur(t),n=Math.ceil(r.length/wr),s=[];for(let o=0;o<n;o++){let i=r.slice(o*wr,(o+1)*wr);s.push({requestId:e,nr:o,totalCount:n,body:i})}return s}function Wn(e){let t=e.split("|");if(t.length===0)return te("empty string");let r=parseInt(t[0],10);if(r!==4)return te(`invalid segment parts: ${r}`);let n=t[1],s=parseInt(t[2],10),o=parseInt(t[3],10),i=t[4];return ee({requestId:n,nr:s,totalCount:o,body:i})}function Ut({nr:e,requestId:t}){return`${t}-${e}`}function Er({requestId:e,nr:t,totalCount:r,body:n}){return[4,e,t,r,n].join("|")}function ye({requestId:e,nr:t,totalCount:r,body:n}){return`segment[rId: ${e}, ${t+1}/${r}, size: ${n.length}]`}function Rr({id:e,originalId:t,provider:r,body:n,clientId:s,entryPeerId:o,exitPeerId:i,exitPublicKey:a,counterOffset:c,measureLatency:u,headers:f,method:l,hops:p,reqRelayPeerId:m,respRelayPeerId:x,chainId:d,timeout:h}){let y=Xr({endpoint:r,clientId:s,body:n,headers:f,method:l,hops:p,relayPeerId:x,withDuration:u,chainId:d,timeout:h});if(he(y))return y;let w=JSON.stringify(y.res),g=lt(w),E=ot.boxRequest({message:g,exitPeerId:i,uuid:e,exitPublicKey:a,counterOffset:c});return ot.isError(E)?te(E.error):ee({request:{id:e,originalId:t,provider:r,body:n,entryPeerId:o,exitPeerId:i,exitPublicKey:a,headers:f,hops:p,measureLatency:u,reqRelayPeerId:m,respRelayPeerId:x,startedAt:performance.now()},session:E.session})}function bf({message:e,requestId:t,exitPeerId:r,exitPrivateKey:n}){let s=ot.unboxRequest({message:e,uuid:t,exitPeerId:r,exitPrivateKey:n});if(ot.isError(s))return te(s.error);if(!s.session.request)return te("Crypto session without request object");let o=Nt(s.session.request);try{let i=JSON.parse(o),a=Jr(i);if(he(a))return a;let c=a.res;return ee({reqPayload:c,session:s.session})}catch(i){return te(`Error during JSON parsing: ${i.toString()}`)}}function Sr(e,t){let r=t.request,n=lt(e.entryPeerId),s=kr(n,r);return Zn(e.id,s)}function me(e){let t=ne(e.entryPeerId),r=ne(e.exitPeerId),n=[`e${t}`];e.reqRelayPeerId?n.push(`r${ne(e.reqRelayPeerId)}`):e.hops!==0&&n.push("(r)"),n.push(`x${r}`),e.respRelayPeerId&&n.push(`r${ne(e.respRelayPeerId)}`);let s=e.id,o=e.provider;return`request[${s}, ${n.join(">")}, ${o}]`}var Yn={};Pe(Yn,{messageToResp:()=>Gn,respToMessage:()=>xf});var it=$t(Kn());function xf({requestId:e,entryPeerId:t,respPayload:r,unboxSession:n}){let s=Qr(r);if(he(s))return s;let o=JSON.stringify(s.res),i=lt(o),a=it.boxResponse(n,{uuid:e,entryPeerId:t,message:i});return it.isError(a)?te(a.error):a.session.response?ee(a.session.response):te("Crypto session without response object")}function Gn({respData:e,request:t,session:r}){let n=it.unboxResponse(r,{uuid:t.id,message:e,entryPeerId:t.entryPeerId});if(it.isError(n))return te(n.error);if(!n.session.response)return te("Crypto session without response object");let s=Nt(n.session.response);try{let o=JSON.parse(s),i=en(o);if(he(i))return i;let a=i.res;return ee({resp:a,session:n.session})}catch(o){return te(`Error during JSON parsing: ${o.toString()}`)}}var Ri={};Pe(Ri,{incoming:()=>Ef,init:()=>wf,remove:()=>Sf,toMessage:()=>Rf});function wf(){return new Map}function Ef(e,t){if(t.totalCount<=0)return{res:"error",reason:"invalid totalCount"};if(t.totalCount===1)return{res:"complete",entry:{segments:new Map([[t.nr,t]]),count:1}};if(e.has(t.requestId)){let n=e.get(t.requestId);return n.segments.has(t.nr)?{res:"already-cached"}:(n.segments.set(t.nr,t),n.count++,t.totalCount===n.count?(e.delete(t.requestId),{res:"complete",entry:n}):{res:"added-to-request"})}let r={segments:new Map([[t.nr,t]]),count:1};return e.set(t.requestId,r),{res:"inserted-new"}}function Rf({segments:e,count:t}){let r=0,n="";for(;r<t;)n+=e.get(r).body,r++;return n}function Sf(e,t){e.delete(t)}var fa={};Pe(fa,{Client:()=>Ar,globalClient:()=>Jf,isLatencyStatistics:()=>Qf});var Xn=30,Si=30,Jn=20;function Pr(){return{state:0}}function vr(e,t){e.state=1,e.latency=t}function Br(e){e.state=2}function es(e){return e.state===1}function Pi(){return{pingDuration:0,segmentsOngoing:[],segmentsHistory:[],segments:new Map,fetchMessagesLatencies:[],fetchMessagesSuccesses:0,fetchMessagesErrors:0,requestsOngoing:0,infoOngoing:0}}function vi(e){e.requestsOngoing++}function rs(e){e.requestsOngoing--}function Bi(e){e.infoOngoing++}function ns(e){e.infoOngoing--,e.infoOngoing<0&&(e.infoOngoing=0)}function Ii(e,t){let r=Ut(t);e.segmentsOngoing.push(r),e.segments.set(r,Pr())}function Ci(e,t,r){let n=Ut(t);if(e.segmentsOngoing=e.segmentsOngoing.filter(o=>o!==n),e.segmentsHistory.push(n),e.segmentsHistory.length>Xn){let o=e.segmentsHistory.shift();e.segments.delete(o)}let s=e.segments.get(n);s&&vr(s,r)}function Ti(e,t){let r=Ut(t);if(e.segmentsOngoing=e.segmentsOngoing.filter(s=>s!==r),e.segmentsHistory.push(r),e.segmentsHistory.length>Xn){let s=e.segmentsHistory.shift();e.segments.delete(s)}let n=e.segments.get(r);n&&Br(n)}function ss(){return{requestsOngoing:[],requestsHistory:[],requests:new Map}}function _i(e,t){e.requestsOngoing.push(t.id),e.requests.set(t.id,Pr())}function Ni(e,t,r){if(e.requestsOngoing=e.requestsOngoing.filter(s=>s!==t.id),e.requestsHistory.push(t.id),e.requestsHistory.length>Jn){let s=e.requestsHistory.shift();e.requests.delete(s)}let n=e.requests.get(t.id);n&&vr(n,r)}function qi(e,t){if(e.requestsOngoing=e.requestsOngoing.filter(n=>n!==t.id),e.requestsHistory.push(t.id),e.requestsHistory.length>Jn){let n=e.requestsHistory.shift();e.requests.delete(n)}let r=e.requests.get(t.id);r&&Br(r)}function Ai(e){let t=e.requestsOngoing.length,r=e.requestsHistory.length,s=e.requestsHistory.map(p=>e.requests.get(p)?.latency).filter(p=>!!p),o=s.length,i=r-o,a=Ve(s),c=e.infoLatMs||-1,u=!!e.infoFail,f=e.counterOffset||0,l=e.version;return{ongoing:t,failures:i,successes:o,total:r,avgLats:a,infoLatMs:c,infoFail:u,version:l,counterOffset:f}}var Ct=$t(ki());function Tt(e){let t=e.join(":"),r=(0,Ct.default)(`${t}:verbose`);r.log=console.log.bind(console);let n=(0,Ct.default)(`${t}:info`);n.log=console.info.bind(console);let s=(0,Ct.default)(`${t}:warn`);s.log=console.warn.bind(console);let o=(0,Ct.default)(`${t}:error`);return o.log=console.error.bind(console),{error:o,info:n,verbose:r,warn:s}}function ji(e,t,r){let n=t||"*",s=Hi(e,r);Ct.default.enable([n,s].join(","))}function Hi(e,t){switch((t||e).toLowerCase()){case"error":return"-*:warn,-*:info,-*:verbose";case"warn":return"-*:info,-*:verbose";case"info":return"-*:verbose";case"verbose":return"";default:return Hi(e)}}var as=333,Fi=1e4,Uf=["2.1"];function $i(e,t,r,n,s,o,i){let a=Pi(),c=ne(t.id),u=Tt(["uhttp-lib",`nodepair${c}(${t.apiEndpoint})`]),f=new Map(r.map(p=>[p.id,p])),l=new Map(r.map(p=>[p.id,ss()]));return{pinnedFetch:e,entryNode:t,entryData:a,exitNodes:f,exitDatas:l,peers:[],relays:[],applicationTag:n,infoTimeouts:new Map,messageListener:s,fetchMessagesOngoing:!1,log:u,hops:o,forceManualRelaying:i}}function Vi(e,t){for(let r of t)e.exitNodes.has(r.id)||(e.exitNodes.set(r.id,r),e.exitDatas.set(r.id,ss()))}function zi(e,t){e.exitNodes.delete(t),e.exitDatas.delete(t)}function cs(e){clearTimeout(e.fetchTimeout),e.fetchTimeout=void 0}function us(e){return e.entryNode.id}function Ki(e,t){let r=e.exitDatas.get(t.exitPeerId);if(!r){e.log.error("started %s on missing exit data",me(t));return}vi(e.entryData),_i(r,t),e.fetchTimeout||(e.fetchTimeout=setTimeout(()=>fs(e),as))}function Zi(e,t,r){let n=e.exitDatas.get(t.exitPeerId);if(!n){e.log.error("successful %s on missing exit data",me(t));return}rs(e.entryData),Ni(n,t,r),Tr(e)}function Wi(e,t){let r=e.exitDatas.get(t.exitPeerId);if(!r){e.log.error("failed %s on missing exit data",me(t));return}rs(e.entryData),qi(r,t),Tr(e)}function Tr(e){e.entryData.requestsOngoing===0&&e.entryData.infoOngoing===0&&(clearTimeout(e.fetchTimeout),e.fetchTimeout=void 0)}function Gi(e,t){Ii(e.entryData,t)}function Yi(e,t,r){Ci(e.entryData,t,r)}function Xi(e,t){Ti(e.entryData,t)}function Ji(e){let t=performance.now();e.hops===0||!e.forceManualRelaying?$r({...e.entryNode,pinnedFetch:e.pinnedFetch}).then(()=>{e.entryData.pingDuration=Math.round(performance.now()-t),e.log.verbose("version ping took %dms",e.entryData.pingDuration)}).catch(r=>{e.log.error("error fetching version: %s[%o]",JSON.stringify(r),r)}):zr({...e.entryNode,pinnedFetch:e.pinnedFetch}).then(r=>jf(e,r,t)).catch(r=>{e.log.error("error fetching peers: %s[%o]",JSON.stringify(r),r)}),Array.from(e.exitNodes.values()).map((r,n)=>{setTimeout(()=>Df(e,r),n)})}function Df(e,t){let r=`info-${e.entryNode.id}-${e.hops??"_"}-${e.forceManualRelaying?"r":"_"}`,n=e.exitDatas.get(t.id);if(!n)return e.log.error("missing exit data for %s before info req",t.id);n.infoLatStarted=performance.now(),ht({...e.entryNode,hops:e.hops,pinnedFetch:e.pinnedFetch},{recipient:t.id,tag:e.applicationTag,message:r}),Bi(e.entryData),e.fetchTimeout||(e.fetchTimeout=setTimeout(()=>fs(e),as));let s=setTimeout(()=>{e.log.warn("timeout (%dms) waiting for info response from x%s",Fi,ne(t.id)),ns(e.entryData),Tr(e);let o=e.exitDatas.get(t.id);if(!o)return e.log.error("missing exit data for x%s during info resp timeout",ne(t.id));o.infoFail=!0},Fi);e.infoTimeouts.set(t.id,s)}function ct(e){let t=e.entryData.segmentsOngoing.length,r=e.entryData.segmentsHistory.length,n=Array.from(e.entryData.segments.values()).reduce((p,m)=>(es(m)&&p.push(m.latency),p),[]),s=e.exitNodes.size,o=Array.from(e.exitDatas).map(([p,m])=>{let x=m.version,d=m.counterOffset?.toFixed(0)||0,h=m.infoFail?"fail":`${m.infoLatMs?.toFixed(0)}ms`,b=m.requestsOngoing.length,y=m.requestsHistory.length,w=Array.from(m.requests.values()).reduce((P,R)=>(es(R)&&P.push(R.latency),P),[]),g=is(e,b,w.length,y,Ve(w));return`${ne(p)}[v${x},o:${d}ms,i:${h},${g}]`}),i=is(e,t,n.length,r,Ve(n)),a=Ve(e.entryData.fetchMessagesLatencies),c=e.entryData.fetchMessagesSuccesses,u=c+e.entryData.fetchMessagesErrors,f=is(e,0,c,u,a),l=e.entryData.pingDuration?`${e.entryData.pingDuration}ms`:"..";return`${ne(us(e))}[ping: ${l}, seg: ${i}, msgs: ${f}, ${s}x: ${o.join(", ")}]`}function is(e,t,r,n,s){if(n===0)return t===0?"0":`0+${t}`;let o=`${r}(${s.toFixed(0)}ms)/${n}`;return t===0?o:`${o}+${t}`}function fs(e){let t=performance.now();Vr({...e.entryNode,pinnedFetch:e.pinnedFetch},e.applicationTag).then(({messages:r})=>{let n=Math.round(performance.now()-t);e.entryData.fetchMessagesSuccesses++,e.entryData.fetchMessagesLatencies.push(n),e.entryData.fetchMessagesLatencies.length>Si&&e.entryData.fetchMessagesLatencies.shift();let{msgs:s,infoResps:o}=r.reduce((i,a)=>(a.body.startsWith("nfrp-")?i.infoResps.push(a):i.msgs.push(a),i),{infoResps:[],msgs:[]});kf(e,o),e.messageListener(s)}).catch(r=>{e.log.error("error fetching node messages: %s[%o]",JSON.stringify(r),r),e.entryData.fetchMessagesErrors++}).finally(()=>{e.fetchTimeout&&(e.fetchTimeout=setTimeout(()=>fs(e),as))})}function kf(e,t){for(let{body:r}of t){let n=r.slice(r.indexOf("-")+1),s=tn(n);if(he(s))return e.log.error("error decoding info payload:",s.error);let{peerId:o,version:i,counter:a,relayShortIds:c}=s.res,u=Hr(o,i,a,c);if(!e.exitNodes.get(o))return e.log.info("info response for missing exit node %s",u);let l=e.exitDatas.get(o);if(!l)return e.log.error("info response missing exit data %s",u);e.log.verbose("got exit node info: %s",u),l.version=i,l.counterOffset=Date.now()-a,l.infoLatMs=l.infoLatStarted&&Math.round(performance.now()-l.infoLatStarted),l.infoFail=!1,l.relayShortIds=c,ns(e.entryData);let p=e.infoTimeouts.get(o);clearTimeout(p),e.infoTimeouts.delete(o)}Tr(e)}function jf(e,t,r){if(Zr(t)){e.log.error("error node internal: %o",t);return}let n=t.connected.filter(({reportedVersion:s})=>Uf.some(o=>s.startsWith(o))).map(({peerId:s,peerAddress:o})=>({peerId:s,peerAddress:o}));Kr({...e.entryNode,pinnedFetch:e.pinnedFetch}).then(s=>{Hf(e,s,n,r)}).catch(s=>{e.log.error("error fetching channels: %s[%o]",JSON.stringify(s),s)})}function Hf(e,t,r,n){e.entryData.pingDuration=Math.round(performance.now()-n),e.log.verbose("channel ping took %dms",e.entryData.pingDuration);let s=t.outgoing.filter(({status:i})=>i==="Open").map(({peerAddress:i})=>i),o=new Set(s);e.peers=r.map(({peerId:i})=>i),e.relays=r.filter(({peerAddress:i})=>o.has(i)).map(({peerId:i})=>i),e.log.verbose("found %d potential relays",e.relays.length)}var $f=["3."];function Qi(e,t){let r=ra(e,t);return ta(e,r)}function ea(e,t,r){let s=ra(e,r).filter(({entryNode:o})=>o.id!==t.id);return ta(e,s)}function kt(e){switch(e.result){case 1:return"no nodes";case 2:return"no nodes matching required version";case 0:{let{entryNode:t,exitNode:r,reqRelayPeerId:n,respRelayPeerId:s}=e.match,o=ne(t.id),i=ne(r.id),a=[`e${o}`];return n&&a.push(`r${ne(n)}`),a.push(`x${i}`),s&&a.push(`r${ne(s)}`),`${a.join(">")} (via ${e.via})`}}}function ta(e,t){if(t.length===0)return{result:1};if(t.length===1)return ls(t[0],"only route available");let r=zf(t);if(r.length===1)return ls(r[0],"only version match");if(r.length===0)return{result:2};let n=r,s=n.map(({infoFail:c})=>c?0:100),o=n.map(({failures:c,ongoing:u,successes:f,total:l})=>l===0?u===0?100:100/u:c===0&&u===0?100-99/f:f>c*3+u?f-(c*3+u):1),i=s.map((c,u)=>c+o[u]),a=Mr(i);return ls(n[a],`weighted random over performance[score ${i[a]}]`)}function ls({entryNode:e,exitNode:t,counterOffset:r,reqRelayPeerId:n,respRelayPeerId:s},o){return{result:0,match:{entryNode:e,exitNode:t,counterOffset:r,reqRelayPeerId:n,respRelayPeerId:s},via:o}}function ra(e,t){return Array.from(e.values()).reduce((r,n)=>{let s=Array.from(n.exitDatas).map(([o,i])=>{let[a,c]=Vf(n,o,i,t);return{...Ai(i),entryNode:n.entryNode,exitNode:n.exitNodes.get(o),reqRelayPeerId:a,respRelayPeerId:c}});if(t){let o=s.filter(({reqRelayPeerId:i,respRelayPeerId:a})=>i&&a);return r.concat(o)}return r.concat(s)},[])}function Vf(e,t,r,n){if(!n)return[];if(!r.relayShortIds)return[];let s=r.relayShortIds,o=e.relays.filter(u=>u!==t&&u!==e.entryNode.id),i=zt(o),a=e.peers.filter(u=>u!==t&&s.find(f=>u.endsWith(f))),c=zt(a);return[i,c]}function zf(e){return e.filter(({version:t})=>t?$f.some(r=>t.startsWith(r)):!0)}function ds(e){return e.result===0}var V=Tt(["uhttp-lib","routing"]),Zf=1e3*60*10,na=10,_r=class{constructor(t,r,n,s,o,i,a,c){this.pinnedFetch=t;this.discoveryPlatformEndpoint=r;this.clientId=n;this.applicationTag=s;this.messageListener=o;this.hops=i;this.clientAssociated=a;this.forceManualRelaying=c;this.nodePairs=new Map;this.destruct=()=>{for(let t of this.nodePairs.values())cs(t);this.nodePairs.clear()};this.requestNodePair=async t=>new Promise((r,n)=>{let s=performance.now(),o=()=>{let a=performance.now()-s,c=Qi(this.nodePairs,this.forceManualRelaying);if(ds(c))return V.verbose("found route pair: %s",kt(c)),r(c.match);if(a>t)return V.error("timeout after %d waiting for node pair: %s",a,kt(c)),n(`Timeout after ${a} ms: ${kt(c)}`);setTimeout(o,100)};o()});this.fallbackNodePair=t=>{let r=ea(this.nodePairs,t,this.forceManualRelaying);if(ds(r))return V.verbose("found fallback route pair: %s",kt(r)),r.match};this.requestStarted=t=>{let r=this.nodePairs.get(t.entryPeerId);if(!r){V.error("started %s on non existing node pair",me(t));return}Ki(r,t),V.verbose("started %s on %s",me(t),ct(r))};this.requestSucceeded=(t,r)=>{let n=this.nodePairs.get(t.entryPeerId);if(!n){V.error("successful %s on non existing node pair",me(t));return}Zi(n,t,r),V.info("successful %s on %s",me(t),ct(n))};this.requestFailed=t=>{let r=this.nodePairs.get(t.entryPeerId);if(!r){V.error("failed %s on non exiting node pair",me(t));return}Wi(r,t),V.warn("failed %s on %s",me(t),ct(r))};this.segmentStarted=(t,r)=>{let n=this.nodePairs.get(t.entryPeerId);if(!n){V.error("started %s on non existing node pair",ye(r));return}Gi(n,r),V.verbose("started %s on %s",ye(r),ct(n))};this.segmentSucceeded=(t,r,n)=>{let s=this.nodePairs.get(t.entryPeerId);if(!s){V.error("successful %s on non existing node pair",ye(r),"");return}Yi(s,r,n),V.verbose("successful %s on %s",ye(r),ct(s))};this.segmentFailed=(t,r)=>{let n=this.nodePairs.get(t.entryPeerId);if(!n){V.error("failed %s on non existing node pair",ye(r));return}Xi(n,r),V.warn("failed %s on %s",ye(r),ct(n))};this.fetchRoutes=t=>{Or({pinnedFetch:t,discoveryPlatformEndpoint:this.discoveryPlatformEndpoint,clientId:this.clientId,forceZeroHop:this.hops===0,clientAssociated:this.clientAssociated},na).then(this.initNodes).catch(r=>{"cause"in r&&"code"in r.cause&&r.cause.code==="ECONNREFUSED"?this.logDPoffline():r.message===Vt?this.logUnauthorized():r.message===_t&&this.nodePairs.size===0?this.logNoNodes():r.message===_t?V.verbose("no new nodes found"):V.error("error fetching node pairs: %s[%o]",JSON.stringify(r),r)}).finally(()=>{this.scheduleFetchRoutes()})};this.initNodes=t=>{let r=new Map(t.exitNodes.map(n=>[n.id,n]));for(let n of t.entryNodes){let s=n.recommendedExits.map(o=>r.get(o)).filter(o=>o.id!==n.id);if(s.length===0)return;if(this.nodePairs.has(n.id)){let o=this.nodePairs.get(n.id);Vi(o,s)}else{let o=$i(this.pinnedFetch,n,s,this.applicationTag,this.messageListener,this.hops,this.forceManualRelaying);this.nodePairs.set(us(o),o)}}this.removeRedundant();for(let[,n]of this.nodePairs)Ji(n);V.info("discovered %d node-pairs with %d exits, matched at %s",this.nodePairs.size,r.size,new Date(t.matchedAt))};this.scheduleFetchRoutes=()=>{let t=Zf+Math.floor(Math.random()*2*6e4),r=Math.floor(t/1e3/60),n=Math.round(t/1e3)-r*60;V.verbose("scheduling next node pair fetching in %dm%ds",r,n),setTimeout(()=>this.fetchRoutes(this.pinnedFetch),t)};this.logDPoffline=()=>{let t=["***","Discovery Platform appears offline","-","Do you have internet access?","***"].join(" "),r=Array.from({length:t.length},()=>"*").join("");V.error(""),V.error(`!!! ${r} !!!`),V.error(`!!! ${t} !!!`),V.error(`!!! ${r} !!!`),V.error(""),this.destruct()};this.logUnauthorized=()=>{let t=["***","Authentication failed","-","Client ID is not valid.","Visit https://access.rpch.net to get a valid Client ID!","***"].join(" "),r=Array.from({length:t.length},()=>"*").join("");V.error(""),V.error(`!!! ${r} !!!`),V.error(`!!! ${t} !!!`),V.error(`!!! ${r} !!!`),V.error(""),this.destruct()};this.logNoNodes=()=>{let t=["***","No node pairs available.","Contact support at https://access.rpch.net to report this problem!","***"].join(" "),r=Array.from({length:t.length},()=>"*").join("");V.error(""),V.error(`!!! ${r} !!!`),V.error(`!!! ${t} !!!`),V.error(`!!! ${r} !!!`),V.error("")};this.removeRedundant=()=>{let r=Array.from(this.nodePairs).reduce((s,[o,i])=>i.exitNodes.size+s,0)-na;if(r<=0)return;let n=Array.from(this.nodePairs).reduce((s,[o,i])=>{let a=Array.from(i.exitNodes.keys()).filter(c=>{let u=i.exitDatas.get(c);return u?u.requestsOngoing.length===0:!0});return s.concat(a.map(c=>[o,c]))},[]);for(V.verbose("removing %d redundant routes",n.length);n.length>0&&r>0;){let s=Kt(n),[o,i]=n[s],a=this.nodePairs.get(o);if(a&&(zi(a,i),a.exitNodes.size===0&&(cs(a),this.nodePairs.delete(o)),r--,n.splice(s,1),r===0))return}};this.fetchRoutes(t)}};function sa(){return new Map}function hs(e,{request:t,resolve:r,reject:n,session:s,timer:o}){let i={request:t,resolve:r,reject:n,session:s,timer:o};return e.set(t.id,i),i}function Nr(e,t){let r=e.get(t)?.timer;clearTimeout(r),e.delete(t)}function ps(e){return crypto&&"randomUUID"in crypto?crypto.randomUUID():Gf()}var ie;function Gf(){if(!ie){ie=[];for(let s=0;s<256;s++)ie[s]=(s<16?"0":"")+s.toString(16)}let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return ie[e&255]+ie[e>>8&255]+ie[e>>16&255]+ie[e>>24&255]+"-"+ie[t&255]+ie[t>>8&255]+"-"+ie[t>>16&15|64]+ie[t>>24&255]+"-"+ie[r&63|128]+ie[r>>8&255]+"-"+ie[r>>16&255]+ie[r>>24&255]+ie[n&255]+ie[n>>8&255]+ie[n>>16&255]+ie[n>>24&255]}function oa(){return new Map}function ia(e,t){if(t.totalCount<=0)return{res:"error",reason:"invalid totalCount"};if(t.totalCount===1)return{res:"complete",entry:{segments:new Map([[t.nr,t]]),count:1}};if(e.has(t.requestId)){let n=e.get(t.requestId);return n.segments.has(t.nr)?{res:"already-cached"}:(n.segments.set(t.nr,t),n.count++,t.totalCount===n.count?(e.delete(t.requestId),{res:"complete",entry:n}):{res:"added-to-request"})}let r={segments:new Map([[t.nr,t]]),count:1};return e.set(t.requestId,r),{res:"inserted-new"}}function aa({segments:e,count:t}){let r=0,n="";for(;r<t;)n+=e.get(r).body,r++;return n}function gs(e,t){e.delete(t)}var ca="3.6.0";var Q=Tt(["uhttp-lib"]),qr,ys=Math.floor(Math.random()*64511+1024),ua={discoveryPlatformEndpoint:"https://discovery.rpch.tech",forceManualRelaying:!1,forceZeroHop:!1,clientAssociatedExitNodes:!1,logLevel:"info",measureLatency:!1,timeout:1e4},jt=globalThis.fetch.bind(globalThis),Ar=class{constructor(t,r){this.clientId=t;this.redoRequests=new Set;this.onRequestCreationHandler=t=>t;this.onLatencyStatisticsHandler=t=>{};this.destruct=()=>{this.nodesColl.destruct();for(let[t]of this.requestCache)Nr(this.requestCache,t),gs(this.segmentCache,t)};this.isReady=async t=>{let r=t??this.settings.timeout;try{await this.nodesColl.requestNodePair(r)}catch(n){return Q.warn("Error finding node pair during isReady: %s",n),!1}return!0};this.fetch=async(t,r)=>{if(r){for(let b of["browsingTopics","cache","credentials","integrity","keepalive","mode","priority","redirect","referrer","referrerPolicy","signal"])if(b in r)throw new Error(`${b} is not supported yet`)}let n=r?.timeout??this.settings.timeout,s=await this.nodesColl.requestNodePair(n).catch(b=>{throw Q.error("Error finding node pair",b),b}),o=this.resolveRequestParams(t,r),{entryNode:i,exitNode:a,counterOffset:c}=s,u=ps(this.requestCache),f=Zt(a.pubKey),l={id:u,clientId:this.clientId,provider:o.endpoint,entryPeerId:i.id,exitPeerId:a.id,exitPublicKey:f,counterOffset:c,hops:this.hops,measureLatency:this.settings.measureLatency,timeout:n};this.settings.forceManualRelaying&&(l.reqRelayPeerId=s.reqRelayPeerId,l.respRelayPeerId=s.respRelayPeerId),o.headers&&(l.headers=jr(o.headers)),o.body&&(l.body=o.body),o.method&&(l.method=o.method);let p=this.onRequestCreationHandler(l),m=Rr(p);if(he(m))throw Q.error("error creating request",m.error),new Error("Unable to create request object");let{request:x,session:d}=m.res,h=Sr(x,d);return new Promise((b,y)=>{let w=setTimeout(()=>{Q.error("%s expired after %dms timeout",me(x),n),this.removeRequest(x),y("Request timed out")},n),g=hs(this.requestCache,{request:x,resolve:b,reject:y,timer:w,session:d});this.nodesColl.requestStarted(x),Q.info("sending request %s",me(x));for(let E of h)this.nodesColl.segmentStarted(x,E),this.sendSegment(x,E,i,g)})};this.overrideGlobalFetch=t=>{globalThis.fetch=async function(r,n){if(typeof t=="function"&&t(r,n)){let s=window?.location.origin??r,o=new URL(r,s);return this.fetch(o,n)}if(t instanceof RegExp&&r.toString().match(t)){let s=window?.location.origin??r,o=new URL(r,s);return this.fetch(o,n)}return jt(r,n)}};this.restoreGlobalFetch=()=>{globalThis.fetch=jt};this.resolveRequestParams=(t,r)=>{if(t instanceof Request){let n=t,s=new Headers(n.headers);return r?.headers instanceof Headers?r.headers.forEach(function(o,i){s.set(i,o)}):r?.headers&&Object.entries(r.headers).forEach(function([o,i]){s.set(o,i)}),{body:r?.body??n.body?.toString(),endpoint:n.url,headers:s,method:r?.method??n.method}}return{body:r?.body,endpoint:t.toString(),headers:r?.headers,method:r?.method}};this.sendSegment=(t,r,n,s)=>{let o=performance.now(),i={apiEndpoint:n.apiEndpoint,accessToken:n.accessToken,hops:t.hops,relay:t.reqRelayPeerId,pinnedFetch:jt};ht(i,{recipient:t.exitPeerId,tag:ys,message:Er(r)}).then(a=>{let c=performance.now();t.lastSegmentEndedAt=c;let u=Math.round(c-o);this.nodesColl.segmentSucceeded(t,r,u)}).catch(a=>{Q.error("error sending %s: %o",ye(r),a),this.nodesColl.segmentFailed(t,r),this.resendRequest(t,n,s)})};this.resendRequest=(t,r,n)=>{if(this.redoRequests.has(t.id)){Q.verbose("ignoring already triggered resend",t.id);return}this.removeRequest(t);let s=this.nodesColl.fallbackNodePair(r);if(!s)throw Q.info("no fallback for resending request available"),new Error("No fallback node pair to retry sending request");this.redoRequests.add(t.id),s.entryNode.id===t.entryPeerId&&Q.info("fallback entry node same as original entry node - still trying"),s.exitNode.id===t.exitPeerId&&Q.info("fallback exit node same as original exit node - still trying");let o=ps(this.requestCache),i=Zt(s.exitNode.pubKey),a=Rr({id:o,originalId:t.id,provider:t.provider,body:t.body,clientId:this.clientId,entryPeerId:s.entryNode.id,exitPeerId:s.exitNode.id,exitPublicKey:i,counterOffset:s.counterOffset,measureLatency:t.measureLatency,headers:t.headers,hops:t.hops,reqRelayPeerId:s.reqRelayPeerId,respRelayPeerId:s.respRelayPeerId});if(he(a))throw Q.error("error creating fallback request",a.error),new Error("Unable to create fallback request object");let{request:c,session:u}=a.res,f=Sr(c,u),l=hs(this.requestCache,{request:c,resolve:n.resolve,reject:n.reject,timer:n.timer,session:u});this.nodesColl.requestStarted(c),Q.info("resending request %s",me(c));for(let p of f)this.resendSegment(p,c,r,l)};this.resendSegment=(t,r,n,s)=>{let o=performance.now();ht({apiEndpoint:n.apiEndpoint,accessToken:n.accessToken,hops:r.hops,relay:r.reqRelayPeerId,pinnedFetch:jt},{recipient:r.exitPeerId,tag:ys,message:Er(t)}).then(i=>{let a=performance.now();r.lastSegmentEndedAt=a;let c=Math.round(a-o);this.nodesColl.segmentSucceeded(r,t,c)}).catch(i=>(Q.error("error resending %s: %o",ye(t),i),this.nodesColl.segmentFailed(r,t),this.removeRequest(r),s.reject("Sending message failed")))};this.onMessages=t=>{for(let{body:r}of t){let n=Wn(r);if(he(n)){Q.info("cannot create segment",n.error);return}let s=n.res;if(!this.requestCache.has(s.requestId)){Q.info("dropping unrelated request segment",ye(s));return}let o=ia(this.segmentCache,s);switch(o.res){case"complete":Q.verbose("completion segment",ye(s)),this.completeSegmentsEntry(o.entry);break;case"error":Q.error("error caching segment",o.reason);break;case"already-cached":Q.info("already cached",ye(s));break;case"inserted-new":Q.verbose("inserted new first segment",ye(s));break;case"added-to-request":Q.verbose("inserted new segment to existing requestId",ye(s));break}}};this.completeSegmentsEntry=t=>{let r=t.segments.get(0),n=this.requestCache.get(r.requestId),{request:s,session:o}=n;Nr(this.requestCache,s.id);let i=aa(t),a=Dr(i);if(he(a))return this.responseError(a.error,n);let c=a.res,u=Gn({respData:c,request:s,session:o});return he(u)?this.responseError(u.error,n):this.responseSuccess(u.res,n)};this.responseError=(t,r)=>{Q.error("error extracting message",t);let n=r.request;return this.nodesColl.requestFailed(n),r.reject("Unable to process response")};this.responseSuccess=({resp:t},r)=>{let{request:n,reject:s,resolve:o}=r,i=Math.round(performance.now()-n.startedAt),a=this.stats(i,n,t);switch(Q.verbose("response time for request %s: %d ms %o",n.id,i,a),this.nodesColl.requestSucceeded(n,i),t.type){case 0:{if(t.data){let c=new Uint8Array(t.data);return o(new Response(c,t))}return o(new Response(null,t))}case 1:{let c=r.session.updatedTS;return s(`Message out of counter range. Exit node expected message counter near ${t.counter} - request got ${c}.`)}case 2:return s("Message duplicate error. Exit node rejected already processed message");case 3:return s(`Error attempting call: ${JSON.stringify(t)}`)}};this.removeRequest=t=>{this.nodesColl.requestFailed(t),Nr(this.requestCache,t.id),gs(this.segmentCache,t.id),t.originalId&&this.redoRequests.delete(t.originalId)};this.mergeSettings=t=>{let r={...ua,...t},n=r.forceZeroHop?!1:r.forceManualRelaying;return{...r,forceManualRelaying:n}};this.determineHops=t=>t?0:1;this.stats=(t,r,n)=>{let s=Math.round(r.lastSegmentEndedAt-r.startedAt);if(r.measureLatency&&"callDuration"in n&&"exitAppDuration"in n&&n.callDuration&&n.exitAppDuration){let i=n.callDuration,a=n.exitAppDuration,c=t-i-a-s,u={segDur:s,rpcDur:i,exitAppDur:a,hoprDur:c};return this.onLatencyStatisticsHandler(u),u}let o={segDur:s};return this.onLatencyStatisticsHandler(o),o};this.errHeaders=t=>({...t,"Content-Type":"application/json"});this.settings=this.mergeSettings(r),(r?.debugScope||r?.logLevel)&&ji(ua.logLevel,this.settings.debugScope,this.settings.logLevel),this.requestCache=sa(),this.segmentCache=oa(),this.hops=this.determineHops(this.settings.forceZeroHop),this.nodesColl=new _r(jt,this.settings.discoveryPlatformEndpoint,this.clientId,ys,this.onMessages,this.hops,this.settings.clientAssociatedExitNodes,this.settings.forceManualRelaying),Q.info("uHTTP client[v%s] started",ca)}};function Jf(e,t){if(qr)return qr;if(!e){let r=["Cannot instantiate uHTTP Client without a clientId.","If you want to use globalClient singleton instance without providing a clientId,","make sure you call `globalClient(clientId)` at least once before!"].join(`
`);throw new Error(r)}return qr=new Ar(e,t),qr}function Qf(e){return"hoprDur"in e}export{Lr as DpApi,Rs as EndpointApi,va as EntryNode,Fr as ExitNode,Wt as NodeApi,pt as Payload,Dt as Request,Yn as Response,ke as Result,fa as Routing,Pt as Segment,Ri as SegmentCache,Ne as Utils};
/**
 * Fast UUID generator, RFC4122 version 4 compliant.
 * @author Jeff Ward (jcward.com).
 * @license MIT license
 * @link http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
 **/
/*! Bundled license information:

@noble/hashes/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/modular.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/curve.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/abstract/weierstrass.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/_shortw_utils.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/